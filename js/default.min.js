function updateCardData(){function e(e){switch(e){case"":return null;case"Damage":return"Attack";case"Heal":return"Heal";case"Shield":return"Shield";default:return console.log('Type of "'+e+'"'),e}}function t(e){switch(e){case"":return"Single";case"All":return"Multi";case"Flurry":return"Single Flurry";case"Flurry-All":return"Multi Flurry";case"Flurry-Self":return"Self Flurry";case"Self":return"Self";case"Splash":return"Splash";default:return console.log('Target of "'+e+'"'),e}}$.get("https://docs.google.com/spreadsheets/d/1xckeq3t9T2g4sR5zgKK52ZkXNEXQGgiUrJ8EQ5FJAPI/pub?output=tsv").then(function(r){var n=bh.Repo.mapTsv(r),i=n.map(function(r){var n=r.Id,i=bh.data.cards.battle.find(n),a=r["Effect Type"].includes("/"),o=a?[0,1]:[0],s={guid:n,name:i&&i.name||r.Name,klassType:bh.KlassType[r.Class.replace("Ranged","Skill").replace("Melee","Might")],elementType:bh.ElementType[r.Element],rarityType:bh.RarityType[r.Rarity.replace(/ /,"")],turns:+r.Turns,types:r["Effect Type"].split(/\s*\/\s*/).map(function(t){return e(t.split(/\s*\-\s*/)[0])}),targets:r["Effect Type"].split(/\s*\/\s*/).map(function(e){return t(e.split(/\s*\-\s*/).slice(1).join("-"))}),brag:bh.utils.parseBoolean(r["Is Brag?"]),minValues:o.map(function(e){return[0,1,2,3,4,5].map(function(e){return r[e+"* Min"]}).filter(function(e){return!!e}).map(function(t){return+t.split(/\s*\/\s*/)[e]})}),maxValues:[0,1,2,3,4,5].map(function(e){return r[e+"* Max"]}).filter(function(e){return!!e}).pop().split(/\s*\/\s*/).map(function(e){return+e}),tier:i&&i.tier||"",mats:[1,2,3,4].map(function(e){return r[e+"* Evo Jar"]}).filter(function(e){return!!e}),perkBase:+r["Perk %"],perks:[1,2,3,4].map(function(e){return r["Perk #"+e]}).filter(function(e){return!!e}),effects:[1,2,3].map(function(e){return r["Effect #"+e]}).filter(function(e){return!!e})};return i?i.name!=r.Name&&console.log(i.name+" !== "+r.Name):console.log(r.Name),s}),a="guid\tname\tklassType\telementType\trarityType\tturns\ttypes\ttargets\tbrag\tminValues\tmaxValues\ttier\tmats\tperkBase\tperks\teffects";i.forEach(function(e){a+="\n"+e.guid+"\t"+e.name+"\t"+bh.KlassType[e.klassType]+"\t"+bh.ElementType[e.elementType]+"\t"+bh.RarityType[e.rarityType]+"\t"+e.turns+"\t"+e.types.join("|")+"\t"+e.targets.join("|")+"\t"+e.brag+"\t"+e.minValues.map(function(e){return e.join(",")}).join("|")+"\t"+e.maxValues.join("|")+"\t"+e.tier+"\t"+e.mats.join(",")+"\t"+e.perkBase+"\t"+e.perks.join(",")+"\t"+e.effects.join(",")}),$("#data-output").val(a)})}var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),bh;(function(e){var t=function(){function e(){this._cache={}}return e.prototype.clearCache=function(){this._cache={}},e.prototype.fromCache=function(e,t){return e in this._cache||(this._cache[e]=t()),this._cache[e]},e}();e.Cacheable=t})(bh||(bh={}));var bh;(function(e){var t;(function(e){e[e.Trait=0]="Trait",e[e.Active=1]="Active",e[e.Passive=2]="Passive"})(t=e.AbilityType||(e.AbilityType={}));var r;(function(e){e[e.Fire=0]="Fire",e[e.Earth=1]="Earth",e[e.Air=2]="Air",e[e.Spirit=3]="Spirit",e[e.Water=4]="Water",e[e.Neutral=5]="Neutral"})(r=e.ElementType||(e.ElementType={}));var n;(function(e){e[e.EvoJar=0]="EvoJar",e[e.Crystal=1]="Crystal",e[e.Rune=2]="Rune"})(n=e.ItemType||(e.ItemType={}));var i;(function(e){e[e.Magic=0]="Magic",e[e.Might=1]="Might",e[e.Skill=2]="Skill"})(i=e.KlassType||(e.KlassType={}));var a;(function(e){e[e.Member=0]="Member",e[e.Elder=1]="Elder",e[e.CoLeader=2]="CoLeader",e[e.Leader=3]="Leader"})(a=e.PositionType||(e.PositionType={}));var o;(function(e){e[e.Common=0]="Common",e[e.Uncommon=1]="Uncommon",e[e.Rare=2]="Rare",e[e.SuperRare=3]="SuperRare",e[e.Legendary=4]="Legendary"})(o=e.RarityType||(e.RarityType={}))})(bh||(bh={}));var bh;(function(e){var t=function(){function t(t,r){this.wildCards=e.data.wildsForEvo(t.rarityType,r),this.minSot=e.data.getMinSotNeeded(t.rarityType,r),this.maxSot=e.data.getMaxSotNeeded(t.rarityType,r),this.minGold=e.data.getMinGoldNeeded(t.rarityType,r)}return t}();e.EvoReport=t;var r=function(){function r(r){this.reports=[];for(var n=r.evo,i=e.data.cards.battle.getMaxEvo(r.rarityType),a=n;a<i;a++)this.reports.push(new t(r,a))}return Object.defineProperty(r.prototype,"next",{get:function(){return this.reports[0]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"wildCards",{get:function(){return this.reports.reduce(function(e,t){return e+t.wildCards},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minSot",{get:function(){return this.reports.reduce(function(e,t){return e+t.minSot},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxSot",{get:function(){return this.reports.reduce(function(e,t){return e+t.maxSot},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"minGold",{get:function(){return this.reports.reduce(function(e,t){return e+t.minGold},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxGold",{get:function(){return this.reports.reduce(function(e,t){return e+t.maxGold},0)},enumerable:!0,configurable:!0}),r}();e.EvoReportCard=r})(bh||(bh={}));var bh;(function(e){function t(e,t){return{hero:e,guid:t.abilityGuid,name:t.abilityName,type:t.abilityType}}var r=function(){function r(e){var r=e[0],n=e[1],i=e[2];this.guid=r.heroGuid,this.name=r.heroName,this.elementType=r.elementType,this.klassType=r.klassType,this.trait=t(this,r),this.active=t(this,n),this.passive=t(this,i),this.lower=this.name.toLowerCase()}return Object.defineProperty(r.prototype,"abilities",{get:function(){return[this.trait,this.active,this.passive]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"allBattleCards",{get:function(){return r.filterCardsByHero(this,e.data.cards.battle.getAll())},enumerable:!0,configurable:!0}),r.prototype.getHitPoints=function(e){return r.getHitPoints(this,e)},Object.defineProperty(r.prototype,"maxPowerRating",{get:function(){return e.PowerRating.rateMaxedHero(this)},enumerable:!0,configurable:!0}),r.filterCardsByHero=function(t,r){return r.filter(function(r){return r.klassType===t.klassType&&(r.elementType==e.ElementType.Neutral||r.elementType==t.elementType)})},r.getHitPoints=function(e,t){switch(e.name){case"Bree":case"Hawkeye":case"Krell":return Math.floor(5*t*t+2.5*t+167.5);case"Monty":case"Trix":return Math.floor(4.286*t*t+2.142*t+143.572);case"Jinx":case"Logan":case"Red":return 4*t*t+2*t+134;case"Fergus":return 6*t*t+3*t+201;case"Brom":case"Gilda":return Math.floor(5.714*t*t+2.858*t+191.438);case"Peg":return Math.floor(4.5*t*t+2*t+153.5);case"Thrudd":return Math.floor(38/7*t*t+19/7*t+190-38/7-19/7);default:return console.log(e.name),0}},r}();e.Hero=r})(bh||(bh={}));var bh;(function(e){var t=function(){function t(e,r,n){t.AllRepos.push(this),this.id="number"==typeof r?e:null,this.gid="number"==typeof r?r:e,this.cacheable=r===!0||n===!0}return t.prototype.init=function(){var r=this;return this._init||(this._init=new Promise(function(n){var i=(e.TSV||{})[String(r.gid||r.id)];if(!i&&r.cacheable)try{var a=JSON.parse(localStorage.getItem(r.id+"-"+r.gid)||null);a&&a.date&&(new Date).getTime()<a.date+864e5&&(i=a.tsv||null)}catch(e){}i?r.resolveTsv(i,n):"number"==typeof r.gid?t.fetchTsv(r.id,r.gid).then(function(e){return r.resolveTsv(e,n)},function(){return r.unresolveTsv()}):n(r.data=[])})),this._init},t.prototype.resolveTsv=function(e,t){var r=this;if(this.cacheable)try{localStorage.setItem(this.id+"-"+this.gid,JSON.stringify({tsv:e,date:(new Date).getTime()}))}catch(e){}var n=this.parseTsv(e);n instanceof Promise?n.then(function(e){return t(e)},function(){return r.unresolveTsv()}):t(n)},t.prototype.unresolveTsv=function(){this.data=[]},t.prototype.parseTsv=function(e){return this.data=t.mapTsv(e)},Object.defineProperty(t.prototype,"all",{get:function(){return this.data.slice()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.data.length},enumerable:!0,configurable:!0}),t.prototype.find=function(e){var t=e.toLowerCase();return this.data.find(function(r){return r.guid==e||r.name==e||r.lower==t})},t.prototype.put=function(e){var t=this.data.findIndex(function(t){return t.guid==e.guid});-1<t?this.data[t]=e:this.data.push(e)},t.fetchTsv=function(t,r){var n="number"==typeof r?t:null,i="number"==typeof r?r:t;return(e.TSV||{})[String(i)]?Promise.resolve(e.TSV[String(i)]):XmlHttpRequest.get(e.host+"/tsv.php?gid="+i+(n?"&id="+n:""))},t.mapTsv=function(t){var r=t.split(/\n/),n=r.shift().split(/\t/).map(function(e){return e.trim()});return r.filter(function(e){return!!e.trim().length}).map(function(t){var r=t.split(/\t/).map(function(e){return e.trim()}),i={};return n.forEach(function(t,n){var a=r[n];switch(t){case"element":case"elementType":i.elementType=e.ElementType[a];break;case"rarity":case"rarityType":i.rarityType=e.RarityType[a.replace(/ /g,"")];break;case"klass":case"klassType":i.klassType=e.KlassType[a];break;case"itemType":i.itemType=e.ItemType[a.replace(/ /g,"")];break;case"abilityType":i.abilityType=e.AbilityType[a];break;case"brag":i.brag=e.utils.parseBoolean(a);break;case"minValues":i[t]=a.split("|").map(function(e){return e.split(",").map(function(e){return+e})});break;case"maxValues":i[t]=a.split("|").map(function(e){return+e});break;case"targets":case"types":i[t]=a.split("|").filter(function(e){return!!e});break;case"effects":case"mats":case"perks":i[t]=a.split(",").filter(function(e){return!!e});break;case"turns":i[t]=+a;break;case"name":i.lower=a.toLowerCase();default:i[t]=a}}),i})},t.init=function(){return t.AllRepos.map(function(e){return e.init()})},t.AllRepos=[],t}();e.Repo=t})(bh||(bh={}));var bh;(function(e){var t=function(t){function r(){return t.call(this,411895816,!0)||this}return __extends(r,t),r.prototype.parseTsv=function(t){var r=this;return new Promise(function(n){for(var i=e.Repo.mapTsv(t),a=[];i.length;)a.push(new e.Hero([i.shift(),i.shift(),i.shift()]));n(r.data=a)})},r.prototype.filterByElement=function(t){return this.data.filter(function(r){return r.elementType===t||e.ElementType[r.elementType]===t})},Object.defineProperty(r.prototype,"sorted",{get:function(){return this._sorted||(this._sorted=this.data.slice().sort(e.utils.sort.byElementThenKlass)),this._sorted},enumerable:!0,configurable:!0}),r.prototype.sortBy=function(e){return e?this.data.slice().sort(e):this.sorted},r}(e.Repo);e.HeroRepo=t})(bh||(bh={}));var bh;(function(e){var t=function(t){function r(){return t.call(this,879699541,!0)||this}return __extends(r,t),Object.defineProperty(r.prototype,"evoJars",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.EvoJar})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"crystals",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.Crystal})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"runes",{get:function(){return this.data.filter(function(t){return t.itemType===e.ItemType.Rune})},enumerable:!0,configurable:!0}),r.getValue=function(t,r){return t==e.ItemType.Crystal?1e3:t==e.ItemType.Rune?2e3:[300,800,1500,3e3][r]},Object.defineProperty(r,"sandsOfTime",{get:function(){return e.data.ItemRepo.find("Sands of Time")},enumerable:!0,configurable:!0}),r}(e.Repo);e.ItemRepo=t})(bh||(bh={}));var bh;(function(e){var t,r=function(){function r(e,t){var n=this;this.win=e,this.callbackfn=t,window.addEventListener("message",function(e){var t=e.data||e.originalEvent&&e.originalEvent.data||null;r.isValidMessage(t)&&(n.updateActive(t),n.callbackfn(t))})}return Object.defineProperty(r.prototype,"targetWindow",{get:function(){if(!this._targetWindow){if(e.isHud){var t=e.$("#gameiframe")[0];this._targetWindow=t&&t.contentWindow||null}e.isListener&&(this._targetWindow=this.win&&this.win.parent||null)}return this._targetWindow||console.log("no target window: "+location.href),this._targetWindow},enumerable:!0,configurable:!0}),r.prototype.updateActive=function(e){e.playerGuid!==e.action&&e.sessionKey!==e.action&&(r.ActivePlayerGuid&&r.ActivePlayerGuid===e.playerGuid||(r.ActivePlayerGuid=e.playerGuid),r.ActiveSessionKey&&r.ActiveSessionKey===e.sessionKey||(r.ActiveSessionKey=e.sessionKey))},r.prototype.postMessage=function(e){r.isValidMessage(e)?(this.updateActive(e),this.targetWindow.postMessage(e,"*")):console.log("invalid message: "+(e&&e.action||"[no message]"))},r.isValidMessage=function(e){if(!e)return!1;var t=Object.keys(e);return t.includes("action")&&t.includes("playerGuid")&&t.includes("sessionKey")&&t.includes("data")},r.createMessage=function(e,t){return{action:e,playerGuid:r.ActivePlayerGuid,sessionKey:r.ActiveSessionKey,data:t}},r.initialize=function(e,n){return t=new r(e,n)},Object.defineProperty(r,"instance",{get:function(){return t},enumerable:!0,configurable:!0}),r}();e.Messenger=r})(bh||(bh={}));var bh;(function(e){function t(t,r,n,i){return"number"==typeof i&&(i=e.utils.formatNumber(i)),'<div data-hud="true">'+e.getImg20(t,r)+" "+n+'<span class="badge pull-right">'+i+"</span></div>"}var r=function(r){function n(t,n){void 0===n&&(n=!1);var i=r.call(this)||this;return i.isArena=n,e.data.isPlayer(t)&&(i._pp=t),e.data.isGuildPlayer(t)&&(i._gp=t),i}return __extends(n,r),Object.defineProperty(n.prototype,"fameLevel",{get:function(){return(this._pp&&this._pp.fameLevel||this._gp.fameLevel)+1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fragments",{get:function(){return this._pp&&this._pp.fragments||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"fragmentsRowHtml",{get:function(){return this._pp?t("misc","Fragments","Fragments",this.fragments):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gems",{get:function(){return this._pp&&this._pp.gems||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gemsRowHtml",{get:function(){return this._pp?t("misc","GemStone","Gems",this.gems):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"gold",{get:function(){return this._pp&&this._pp.gold||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"goldNeeded",{get:function(){var e=this;return this.fromCache("goldNeeded",function(){var t=0;return e.activeBattleCards.forEach(function(e){return t+=e.maxMaxGoldNeeded}),e.heroes.forEach(function(e){return t+=e?e.trait.maxGoldCost+e.active.maxGoldCost+e.passive.maxGoldCost:0}),t})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"goldRowHtml",{get:function(){var r=this.goldNeeded,n="<sup>*</sup>",i=r?e.utils.formatNumber(this.gold)+" / "+e.utils.formatNumber(Math.abs(r))+n:e.utils.formatNumber(this.gold);return this._pp?t("misc","Coin","Gold",i):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guid",{get:function(){return this._pp&&this._pp.id||this._gp.playerId},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guild",{get:function(){return e.data.guilds.findByGuid(this.guildGuid)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guildGuid",{get:function(){return this._pp?this._pp.playerGuild||null:this._gp&&this._gp.guildId||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guildParent",{get:function(){var t=e.data.guilds.findNameByGuid(this.guildGuid);return t&&t.parent||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"guilds",{get:function(){var t=this;return this.fromCache("guilds",function(){return e.data.guilds.filterNamesByParent(t.guildParent)})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"heroes",{get:function(){var t=this;return this.fromCache("heroes",function(){var r;return r=t._pp?t._pp.archetypes||[]:Object.keys(t._gp.archetypeLevels).map(function(e){return{playerId:t.guid,id:e,level:t._gp.archetypeLevels[e]}}),r.map(function(r){return new e.PlayerHero(t,r)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isAlly",{get:function(){var e=this;return this.fromCache("isAlly",function(){return!!n.me.guilds.find(function(t){return t.guid==e.guildGuid})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canScout",{get:function(){return"b0a8b57b-54f5-47d8-8b7a-f9dac8300ca0"==this.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isExtended",{get:function(){return!!this._pp},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isFullMeat",{get:function(){return this.heroes.length==e.data.HeroRepo.length&&!this.heroes.find(function(e){return!e.isMeat})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isMe",{get:function(){return e.Messenger.ActivePlayerGuid==this.guid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._pp?this._pp.name:this._gp&&this._gp.name||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"position",{get:function(){return this._gp&&this._gp.position||null},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"averagePowerPercent",{get:function(){var e=this.heroes.map(function(e){return e.powerPercent});return Math.floor(e.reduce(function(e,t){return e+t},0)/e.length)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"powerPercent",{get:function(){var t=this.heroes.map(function(e){return e.powerPercent}).reduce(function(e,t){return e+t},0),r=100*e.data.HeroRepo.length;return Math.floor(100*t/r)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"powerRating",{get:function(){return this.heroes.reduce(function(e,t){return e+t.powerRating},0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"raidRowHtml",{get:function(){return this._pp?t("keys","RaidTicket","Raid Tickets",this.raidTickets):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"raidTickets",{get:function(){return this._pp&&this._pp.raidKeys||0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"battleCards",{get:function(){var e=this;return this.fromCache("battleCards",function(){return e._pp&&e._pp.playerCards&&e._pp.playerCards.cards?e.sortAndReduceBattleCards(Object.keys(e._pp.playerCards.cards)):[]})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activeBattleCards",{get:function(){var e=this;return this.fromCache("activeBattleCards",function(){return e.battleCards.filter(function(e){return e.isActive})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activeRecipes",{get:function(){var t=this;return this.fromCache("activeRecipes",function(){return t.activeBattleCards.map(function(t){return new e.Recipe(t,!0)}).filter(function(e){return!!e})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterCards",{get:function(){var t=this._pp&&this._pp.feederCardsMap;return t?Object.keys(t).map(function(r){return new e.PlayerBoosterCard(r,t[r])}).sort(e.utils.sort.byElementThenRarityThenName):[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterCount",{get:function(){var e=0,t=this._pp&&this._pp.feederCardsMap;return Object.keys(t||{}).map(function(r){return e+=t[r]}),e},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boosterRowHtml",{get:function(){return this._pp?e.PlayerBoosterCard.rowHtml(this.boosterCount):""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inventory",{get:function(){var t=this,r=this._pp&&this._pp.craftingMaterials;return this.heroes,r?Object.keys(r).map(function(n){return new e.PlayerInventoryItem(t,e.data.ItemRepo.find(n),r[n])}).sort(e.utils.sort.byRarityThenName):[]},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wildCards",{get:function(){var t=this;return this.fromCache("wildCards",function(){return e.data.WildCardRepo.all.map(function(r){return new e.PlayerWildCard(t,r.guid)})})},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"wildCardRowHtml",{get:function(){return this._pp?t("cardtypes","WildCard","Wild Cards",this.wildCards.filter(function(e){return e.count}).slice(-3).map(function(t){return e.RarityType[t.rarityType][0]+":"+t.count}).join(" / ")):""},enumerable:!0,configurable:!0}),n.prototype.battleCardToPlayerBattleInfo=function(t){var r=this._pp.playerCards.cards[t];return new e.PlayerBattleCard(r)},n.prototype.filterActiveBattleCards=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n,i,a,o;return t.forEach(function(t){return e.isElement(t)?n=t:e.isRarity(t)?i=t:a=t}),a&&(o=e.data.HeroRepo.find(a)),this.activeBattleCards.filter(function(e){return e.matchesElement(n)&&e.matchesRarity(i)&&e.matchesHero(o)})},n.prototype.filterHeroes=function(t){var r=e.isElement(t)?t:null,n=r?null:t;return this.heroes.filter(function(t){return t&&(r&&e.ElementType[t.elementType]==r||n&&t.name==n)})},n.prototype.findPlayerCard=function(e){var t=this._pp&&this._pp.playerCards.cards,r=t&&t[e];if(!r&&t){var n=Object.keys(t),i=n.find(function(r){return r==e||t[r].configId==e});r=t[i]}return r},n.prototype.merge=function(e){var t=this._pp&&this._pp.archetypes||[],r=e.archetypes||[];r.forEach(function(e){t.find(function(t){return t.id==e.id})||t.push(e)})},n.prototype.sortAndReduceBattleCards=function(t){var r=this,n=t.map(function(e){return r.battleCardToPlayerBattleInfo(e)}),i=n.sort(e.utils.sort.byRarityThenNameThenEvoLevel),a=[];return i.forEach(function(e){var t=a.find(function(t){return t.matches(e)});t?t.count++:a.push(e)}),a},Object.defineProperty(n,"me",{get:function(){return e.data.PlayerRepo.find(e.Messenger.ActivePlayerGuid)},enumerable:!0,configurable:!0}),n}(e.Cacheable);e.Player=r})(bh||(bh={}));var bh;(function(e){var t=function(){function t(t){this.count=1,this.playerCard=t,this._bc=e.data.cards.battle.find(t.configId),this._bc||e.utils.logMissingCard(this)}return t.prototype._rowChildren=function(){var t=this,r="";if(!this.isUnknown){var n=e.Player.me,i=new e.Recipe(this,!0);if(i){var a=e.data.calcMaxGoldNeeded(this.playerCard,this.evoLevel)*this.count,o=n.gold,s=o<a?"bg-danger":"bg-success";r+="<div>"+e.getImg20("misc","Coin")+' Gold <span class="badge pull-right '+s+'">'+e.utils.formatNumber(o)+" / "+e.utils.formatNumber(a)+"</span></div>",i.all.forEach(function(i){var a=n.inventory.find(function(e){return e.guid==i.item.guid});r+=e.PlayerInventoryItem.toRowHtml(a,a.count,i.max*t.count)});var u=e.data.getMaxWildCardsNeeded(this)*this.count,l=n.wildCards[this.rarityType]&&n.wildCards[this.rarityType].count||0,c=l<u?"bg-danger":"bg-success";r+="<div>"+e.getImg20("cardtypes","WildCard")+" "+e.RarityType[this.rarityType]+' WC <span class="badge pull-right '+c+'">'+e.utils.formatNumber(l)+" / "+e.utils.formatNumber(u)+"</span></div>"}}return r},t.prototype._rowHtml=function(t,r){var n=t?'<span class="badge pull-right '+(r||"")+'">'+t+"</span>":"",i="number"==typeof t||this.isMaxed?"":this._rowChildren(),a=e.renderExpandable(this.playerCard.id,""+this.fullHtml+n,i);return'<div -class="'+e.ElementType[this.elementType]+'" data-element-type="'+this.elementType+'" data-rarity-type="'+this.rarityType+'" data-klass-type="'+this.klassType+'" data-brag="'+(this.brag?"Brag":"")+'">'+a+"</div>"},Object.defineProperty(t.prototype,"brag",{get:function(){return this._bc&&this._bc.brag||!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effects",{get:function(){return this._bc&&this._bc.effects||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementType",{get:function(){return this._bc?this._bc.elementType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"klassType",{get:function(){return this._bc?this._bc.klassType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lower",{get:function(){return this.name.toLowerCase()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mats",{get:function(){return this._bc&&this._bc.mats||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxValues",{get:function(){return this._bc&&this._bc.maxValues||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minValues",{get:function(){return this._bc&&this._bc.minValues||[[]]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perkBase",{get:function(){return this._bc&&this._bc.perkBase||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"perks",{get:function(){return this._bc&&this._bc.perks||[]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._bc&&this._bc.name||this.playerCard&&this.playerCard.configId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return this._bc?this._bc.rarityType:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"targets",{get:function(){return this._bc&&this._bc.targets||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tier",{get:function(){return this._bc&&this._bc.tier||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"turns",{get:function(){return this._bc&&this._bc.turns||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){return this._bc&&this._bc.types||null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evo",{get:function(){return this.playerCard&&this.playerCard.evolutionLevel||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this.playerCard&&this.playerCard.configId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"level",{get:function(){return this.playerCard&&this.playerCard.level+1||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"battleOrBragImage",{get:function(){return e.getImg20("cardtypes",this.brag?"Brag":"BattleCard")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"evoLevel",{get:function(){return this.evo+"."+("0"+this.level).slice(-2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"formattedValue",{get:function(){return this.value?e.utils.formatNumber(this.value):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullHtml",{get:function(){var t=this.count>1?"x"+this.count:"",r=this.value?" ("+this.typeImage+" "+this.formattedValue+")":"",n=e.utils.evoToStars(this.rarityType,this.evoLevel),i=this.name.replace(/Mischievous/,"Misch.").replace(/Protection/,"Prot.").replace(/-[\w-]+-/,"-...-");return this.battleOrBragImage+" "+this.evoLevel+" <small>"+n+"</small> "+i+" "+r+" "+t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isActive",{get:function(){return(this.evo>0||this.level>1)&&!this.isMaxed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMaxed",{get:function(){return this.evoLevel==["1.10","2.20","3.35","4.50","5.50"][this.rarityType]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isUnknown",{get:function(){return!this._bc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxWildCardsNeeded",{get:function(){return e.data.getMaxWildCardsNeeded(this)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextWildCardsNeeded",{get:function(){return e.data.getNextWildCardsNeeded(this)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMaxSotNeeded",{get:function(){return e.data.calcMaxSotNeeded(this.playerCard,this.evoLevel)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextMaxSotNeeded",{get:function(){return e.data.getMaxSotNeeded(this.rarityType,this.evo)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMaxGoldNeeded",{get:function(){return e.data.calcMaxGoldNeeded(this.playerCard,this.evoLevel)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextMaxGoldNeeded",{get:function(){return e.data.getMaxGoldNeeded(this.rarityType,this.evo)*this.count},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"powerRating",{get:function(){return e.PowerRating.ratePlayerCard(this.playerCard)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityEvoLevel",{get:function(){return e.RarityType[this.rarityType][0]+"."+this.evoLevel},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){return this._rowHtml()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scoutHtml",{get:function(){return this.rarityEvoLevel+" "+this.name+" "+(this.count>1?"x"+this.count:"")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"typeImage",{get:function(){return this.types.length?e.getImg12("cardtypes",this.types[0]):""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){return this.playerCard&&e.data.cards.battle.calculateValue(this.playerCard)||0},enumerable:!0,configurable:!0}),t.prototype.matches=function(e){return this._bc&&e._bc&&this._bc.guid==e._bc.guid&&this.evoLevel==e.evoLevel},t.prototype.matchesElement=function(t){return!t||this.elementType===e.ElementType[t]},t.prototype.matchesHero=function(t){return!t||this.matchesElement(e.ElementType[t.elementType])&&this.klassType===t.klassType},t.prototype.matchesRarity=function(t){return!t||this.rarityType===e.RarityType[t]},t.prototype.toRowHtml=function(e,t){return this._rowHtml(e,t<e?"bg-danger":"bg-success")},t}();e.PlayerBattleCard=t})(bh||(bh={}));var bh;(function(e){var t=function(){function t(t,r){void 0===r&&(r=0),this.count=r,this.type="BoosterCard",this._=e.data.BoosterCardRepo.find(t)}return Object.defineProperty(t.prototype,"challenge",{get:function(){return this._.challenge},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementType",{get:function(){return this._.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this._.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return this._.rarityType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){return'<div class="'+e.ElementType[this.elementType]+'" data-element-type="'+this.elementType+'" data-type="'+this.type+'" data-rarity-type="'+this.rarityType+'">'+e.getImg20("misc","Boosters")+" "+e.RarityType[this.rarityType][0]+(this.challenge?"*":"")+" "+this.name+' <span class="badge pull-right">'+e.utils.formatNumber(this.count)+"</span></div>"},enumerable:!0,configurable:!0}),t.rowHtml=function(t){return'<div data-hud="true">'+e.getImg20("misc","Boosters")+' Boosters <span class="badge pull-right">'+e.utils.formatNumber(t)+"</span></div>"},t}();e.PlayerBoosterCard=t})(bh||(bh={}));var bh;(function(e){var t=function(t){function r(r,n){var i=t.call(this)||this;return i.player=r,i.archetype=n,i.hero=e.data.HeroRepo.find(n.id),i}return __extends(r,t),r.prototype.getAbilityLevel=function(e){var t=this.archetype.abilityLevels?this.archetype.abilityLevels[this.hero.abilities[e].guid]:null;return isNaN(t)?0:t+1},Object.defineProperty(r.prototype,"abilities",{get:function(){return this.hero.abilities},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"abilityLevels",{get:function(){return this.archetype.abilityLevels},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"active",{get:function(){var t=this;return this.fromCache("active",function(){return new e.PlayerHeroAbility(t,t.hero.active,t.getAbilityLevel(e.AbilityType.Active))})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"guid",{get:function(){return this.hero.guid;
},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"elementType",{get:function(){return this.hero.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"klassType",{get:function(){return this.hero.klassType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this.hero.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"passive",{get:function(){var t=this;return this.fromCache("passive",function(){return new e.PlayerHeroAbility(t,t.hero.passive,t.getAbilityLevel(e.AbilityType.Passive))})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"trait",{get:function(){var t=this;return this.fromCache("trait",function(){return new e.PlayerHeroAbility(t,t.hero.trait,t.getAbilityLevel(e.AbilityType.Trait))})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"activePowerRating",{get:function(){return this.active.powerRating},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"battleCards",{get:function(){return e.Hero.filterCardsByHero(this.hero,this.player.battleCards)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deck",{get:function(){return this.player.sortAndReduceBattleCards(this.archetype.deck)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"deckPowerRating",{get:function(){return this.deck.reduce(function(t,r){return t+e.PowerRating.ratePlayerCard(r.playerCard)*r.count},0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hitPoints",{get:function(){return this.hero.getHitPoints(this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"hitPointsPowerRating",{get:function(){return e.PowerRating.ratePlayerHeroHitPoints(this)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isActiveCapped",{get:function(){return this.active.level==e.getMaxActive(this.hero,this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCapped",{get:function(){return this.isActiveCapped&&this.isPassiveCapped&&this.isTraitCapped},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isMeat",{get:function(){return this.level==e.MaxLevel&&this.isCapped},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isOp",{get:function(){return!!this.deck.find(function(e){return"OP"==e.tier})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPassiveCapped",{get:function(){return this.passive.level==e.getMaxPassive(this.hero,this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isTraitCapped",{get:function(){return this.trait.level==e.getMaxTrait(this.level)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"level",{get:function(){return this.archetype.level+1},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"passivePowerRating",{get:function(){return this.passive.powerRating},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"playerHeroAbilities",{get:function(){return[this.trait,this.active,this.passive]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"playerHeroGuid",{get:function(){return this.player.guid+"-"+this.hero.guid},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"powerPercent",{get:function(){return Math.floor(100*this.powerRating/this.hero.maxPowerRating)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"powerRating",{get:function(){return Math.round(this.hitPointsPowerRating+this.traitPowerRating+this.activePowerRating+this.passivePowerRating+this.deckPowerRating)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"traitPowerRating",{get:function(){return this.trait.powerRating},enumerable:!0,configurable:!0}),r}(e.Cacheable);e.PlayerHero=t})(bh||(bh={}));var bh;(function(e){function t(e){return e<2?1:e<10?2:e<18?3:e<25?4:e<33?5:e<41?6:e<49?7:e<56?8:e<64?9:e<72?10:e<80?11:e<87?12:13}function r(e){if(1==e)return 1e3;for(var t=754,r=3e3,n=2;n<e;n++)r+=t,t+=8;return r}function n(e){return e<2?1:e<7?3:e<13?4:e<18?5:e<23?6:e<28?7:e<33?8:e<38?9:e<43?10:e<48?11:e<53?12:e<58?13:e<63?14:e<68?15:e<73?16:17}function i(e){if(1==e)return 5e3;for(var t=510,r=3500,n=2;n<e;n++)r+=t,t+=20;return r}function a(e){return e<2?2:e<6?4:e<9?5:e<12?6:e<16?7:e<19?8:e<22?9:e<26?10:e<29?11:e<32?12:e<36?13:e<39?14:e<42?15:e<46?16:e<49?17:e<52?18:e<56?19:e<59?20:21}function o(e){if(1==e)return 7e3;for(var t=1015,r=1e4,n=2;n<e;n++)r+=t,t+=30;return r}function s(r,i){switch(r){case e.AbilityType.Trait:return t(i);case e.AbilityType.Active:return n(i);case e.AbilityType.Passive:return a(i)}}function u(e,t,r){for(var n=0,i=t+1,a=r+1;i<a;i++)n+=s(e,i);return n}function l(t,n){switch(t){case e.AbilityType.Trait:return r(n);case e.AbilityType.Active:return i(n);case e.AbilityType.Passive:return o(n)}}function c(e,t,r){for(var n=0,i=t+1,a=r+1;i<a;i++)n+=l(e,i);return n}e.getMaterialCountFor=s,e.getMaterialCountForRange=u,e.getGoldCostFor=l,e.getGoldCostForRange=c;var d=function(){function t(e,t,r){this.playerHero=e,this.heroAbility=t,this.level=r}return Object.defineProperty(t.prototype,"_type",{get:function(){if("Jinx"==this.hero.name){if(this.type==e.AbilityType.Active)return e.AbilityType.Passive;if(this.type==e.AbilityType.Passive)return e.AbilityType.Active}return this.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hero",{get:function(){return this.heroAbility.hero},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this.heroAbility.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.heroAbility.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this.heroAbility.type},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLocked",{get:function(){return!this.level},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isCapped",{get:function(){return this.level==this.levelCap},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isMaxed",{get:function(){return this.level==this.levelMax},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelCap",{get:function(){return e.getAbilityLevelCap(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"levelMax",{get:function(){return e.getAbilityLevelMax(this)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextMaterialCount",{get:function(){return s(this._type,this.level+1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxMaterialCount",{get:function(){var t=this._type,r=e.getAbilityMaxLevel(this.hero,this.heroAbility.type);return u(t,this.level,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextGoldCost",{get:function(){return l(this._type,this.level+1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxGoldCost",{get:function(){var t=(this._type,e.getAbilityMaxLevel(this.hero,this.heroAbility.type));return c(this._type,this.level,t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"img",{get:function(){return e.getImg("skills",this.playerHero.name+e.AbilityType[this.type])},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"materialHtml",{get:function(){var t=this,r=this.playerHero.player,n=e.AbilityType.Trait?r.inventory.find(function(e){return e.isRune&&e.name.startsWith(t.name)}):r.inventory.find(function(e){return e.isCrystal&&e.elementType==t.playerHero.elementType}),i=n.count,a=i<this.maxMaterialCount?"bg-danger":"bg-success",o=this.type==e.AbilityType.Trait?e.getImg("runes",this.name.replace(/\W/g,"")):e.getImg("crystals",e.ElementType[this.hero.elementType]);return"<div>"+o+" "+n.name+' <span class="badge pull-right '+a+'">'+e.utils.formatNumber(i)+" / "+e.utils.formatNumber(this.maxMaterialCount||0)+"</span></div>"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"goldHtml",{get:function(){var t=this.playerHero.player.gold||0,r=t<this.maxGoldCost?"bg-danger":"bg-success";return"<div>"+e.getImg("misc","Coin")+' Gold <span class="badge pull-right '+r+'">'+e.utils.formatNumber(t)+" / "+e.utils.formatNumber(this.maxGoldCost||0)+"</span></div>"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"powerRating",{get:function(){return e.PowerRating.ratePlayerHeroAbility(this)*(this.level/e.getAbilityMaxLevel(this.hero,this.type))},enumerable:!0,configurable:!0}),t.prototype.toRowHtml=function(t,r){var n=t&&r?r<t?"bg-danger":"bg-success":"",i="number"==typeof t?'<span class="badge pull-right '+n+'">'+e.utils.formatNumber(t)+"</span>":"";return"<div>"+this.img+" "+this.playerHero.name+" "+e.AbilityType[this.type]+" "+i+"</div>"},t}();e.PlayerHeroAbility=d})(bh||(bh={}));var bh;(function(e){function t(e,t,r){if(!r)return"<div>"+t+"</div>";var n='<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-button" type="button" data-action="toggle-child" data-guid="'+e+'">[+]</button>',i='<div class="brain-hud-child-scroller" data-parent-guid="'+e+'">'+r+"</div>";return"<div>"+t+" "+n+"</div>"+i}var r=function(){function r(e,t,r){void 0===r&&(r=0),this.player=e,this.item=t,this.count=r}return Object.defineProperty(r.prototype,"elementType",{get:function(){return this.item.elementType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"guid",{get:function(){return this.item.guid},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"itemType",{get:function(){return this.item.itemType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this.item.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rarityType",{get:function(){return this.item.rarityType},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCrystal",{get:function(){return this.itemType===e.ItemType.Crystal},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isEvoJar",{get:function(){return this.itemType===e.ItemType.EvoJar},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isSandsOfTime",{get:function(){return"Sands of Time"===this.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isRune",{get:function(){return this.itemType===e.ItemType.Rune},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"needed",{get:function(){var t=this,r=0;if(this.isRune){var n=this.name.split("'")[0];this.player.filterHeroes(n).forEach(function(e){return r+=e.trait.maxMaterialCount||0}),this.player.filterActiveBattleCards(n,"Legendary").forEach(function(e){return r+=60*e.count})}else if(this.isCrystal)this.player.filterHeroes(e.ElementType[this.elementType]).forEach(function(e){return r+=(e.active.maxMaterialCount||0)+(e.passive.maxMaterialCount||0)}),this.player.filterActiveBattleCards(e.ElementType[this.elementType],"Legendary").forEach(function(e){return r+=60*e.count});else if(this.isSandsOfTime)this.player.activeBattleCards.forEach(function(e){return r+=e.maxMaxSotNeeded});else{var i=this.player.activeRecipes,a=i.filter(function(e){return!!e.getItem(t)});a.forEach(function(e){return r+=e.getMaxNeeded(t)})}return r},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rowHtml",{get:function(){var r=this,n=e.ItemType[this.itemType].toLowerCase()+"s",i=this.isEvoJar?this.name.replace(/\W/g,""):this.isCrystal?this.name.split(/ /)[0]:e.data.HeroRepo.find(this.name.split("'")[0]).abilities[0].name.replace(/\W/g,""),a=e.getImg20(n,i),o=this.needed,s=o?" / "+e.utils.formatNumber(o):"",u=o?this.count<o?"bg-danger":"bg-success":"",l='<span class="badge pull-right '+u+'">'+e.utils.formatNumber(this.count)+s+"</span>",c="";if(o)if(this.isCrystal)this.player.filterHeroes(e.ElementType[this.elementType]).forEach(function(e){var t,n,i=e.active,a=e.passive;(t=i.maxMaterialCount)&&(c+=i.toRowHtml(t,r.count)),(n=a.maxMaterialCount)&&(c+=a.toRowHtml(n,r.count))}),this.player.filterActiveBattleCards(e.ElementType[this.elementType],"Legendary").forEach(function(t){var n=t.count*e.data.calcMaxCrystalsNeeded(t.playerCard,t.evoLevel);c+=t.toRowHtml(n,r.count)});else if(this.isRune){var d=this.name.split("'")[0];this.player.filterHeroes(d).forEach(function(e){var t,n=e.trait;(t=n.maxMaterialCount)&&(c+=n.toRowHtml(t,r.count))}),this.player.filterActiveBattleCards(d,"Legendary").forEach(function(t){var n=t.count*e.data.calcMaxRunesNeeded(t.playerCard,t.evoLevel);c+=t.toRowHtml(n,r.count)})}else if(this.isSandsOfTime)this.player.activeBattleCards.forEach(function(e){e.maxMaxSotNeeded,c+=e.toRowHtml(e.maxMaxSotNeeded,r.count)});else{var p=this.player.activeRecipes,f=p.filter(function(e){var t=e.getItem(r);return t&&0!=t.max});f.forEach(function(e){var t=e.getMaxNeeded(r);c+=e.card.toRowHtml(t,r.count)})}return'<div data-element-type="'+this.elementType+'" data-rarity-type="'+this.rarityType+'" data-item-type="'+this.itemType+'" data-hud="'+this.isSandsOfTime+'">'+t(this.guid,a+" "+this.name+" "+l,c)+"</div>"},enumerable:!0,configurable:!0}),r.toRowHtml=function(t,r,n){var i=e.ItemType[t.itemType].toLowerCase()+"s",a=t.isEvoJar?t.name.replace(/\W/g,""):t.isCrystal?t.name.split(/ /)[0]:e.data.HeroRepo.find(t.name.split("'")[0]).abilities[0].name.replace(/\W/g,""),o=e.getImg20(i,a),s=r<n?"bg-danger":"bg-success",u='<span class="badge pull-right '+s+'">'+e.utils.formatNumber(r)+" / "+e.utils.formatNumber(n)+"</span>";return"<div>"+o+" "+t.name+" "+u+"</div>"},r}();e.PlayerInventoryItem=r,e.renderExpandable=t})(bh||(bh={}));var bh;(function(e){var t=function(){function t(t,r){this.player=t,this.type="WildCard",this._=e.data.WildCardRepo.find(r)}return Object.defineProperty(t.prototype,"count",{get:function(){return this.player._pp?this.player._pp.wildcards[this.guid]||0:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"guid",{get:function(){return this._.guid},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"html",{get:function(){var t=this.needed,r=t?" / "+e.utils.formatNumber(t):"",n=t?this.count<t?"bg-danger":"bg-success":"",i='<span class="badge pull-right '+n+'">'+this.count+r+"</span>";return e.getImg("cardtypes","WildCard")+" "+this.name+" WC "+i},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this._.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"needed",{get:function(){var t=0;return this.player.filterActiveBattleCards(e.RarityType[this.rarityType]).forEach(function(e){return t+=e.maxWildCardsNeeded}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rarityType",{get:function(){return e.RarityType[this._.name.replace(/ /g,"")]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rowHtml",{get:function(){var t=this,r=this.html,n="",i="";return this.needed&&(n='<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-button" type="button" data-action="toggle-child" data-guid="'+this.guid+'">[+]</button>',i='<div class="brain-hud-child-scroller" data-parent-guid="'+this.guid+'">',this.player.filterActiveBattleCards(e.RarityType[this.rarityType]).forEach(function(e){return i+=e.toRowHtml(e.maxWildCardsNeeded,t.count)}),i+="</div>"),'<div data-type="'+this.type+'" data-rarity-type="'+this.rarityType+'"><div>'+r+" "+n+"</div>"+i+"</div>"},enumerable:!0,configurable:!0}),t}();e.PlayerWildCard=t})(bh||(bh={}));var bh;(function(e){function t(e,t){switch(e.name){case"Bree":return"HP"==t?f:"Trait"==t?p:"Active"==t?h:y;case"Brom":return"HP"==t?f:"Trait"==t?p:"Active"==t?h:y;case"Fergus":return"HP"==t?l:"Trait"==t?c:"Active"==t?d:u;case"Gilda":return"HP"==t?d:"Trait"==t?l:"Active"==t?u:c;case"Hawkeye":return"HP"==t?d:"Trait"==t?u:"Active"==t?c:l;case"Jinx":return"HP"==t?m:"Trait"==t?g:"Active"==t?b:v;case"Krell":return"HP"==t?c:"Trait"==t?u:"Active"==t?l:d;case"Logan":return"HP"==t?y:"Trait"==t?f:"Active"==t?h:p;case"Monty":return"HP"==t?d:"Trait"==t?u:"Active"==t?l:c;case"Peg":return"HP"==t?d:"Trait"==t?u:"Active"==t?l:c;case"Red":return"HP"==t?d:"Trait"==t?u:"Active"==t?c:l;case"Thrudd":return"HP"==t?f:"Trait"==t?p:"Active"==t?h:y;case"Trix":return"HP"==t?d:"Trait"==t?c:"Active"==t?u:l;default:return 0}}function r(t,r,i,a){return n*(r*s[e.RarityType[t]]+i)*a}var n=2.5,i=5e3,a={Common:1,Uncommon:2,Rare:3,SuperRare:4,Legendary:5},o={Common:10,Uncommon:20,Rare:35,SuperRare:50,Legendary:50},s={Common:10,Uncommon:20,Rare:35,SuperRare:50,Legendary:60},u=.4*i,l=.25*i,c=.2*i,d=.15*i,p=u+.4*d,f=l+.25*d,y=c+.2*d,h=.15*d,g=u+.45*d,b=l+.3*d,m=c+.25*d,v=0,T=function(){function n(){}return n.rateMaxedHero=function(e){var r=t(e,"HP"),i=t(e,"Trait"),a=t(e,"Active"),o=t(e,"Passive"),s=n.rateMaxedDeck(e);return r+i+a+o+s},n.rateMaxedDeck=function(t){var r=e.Hero.filterCardsByHero(t,e.data.cards.battle.getAll()),i=r.map(function(e){return{card:e,score:n.rateMaxedBattleCard(e)}}).sort(function(e,t){return e.score==t.score?0:e.score<t.score?1:-1}),a=i.slice(0,4),o=a.reduce(function(e,t){return e+2*t.score},0);return o},n.rateMaxedBattleCard=function(t){var r=e.RarityType[t.rarityType],i=a[r],s=o[r];return n.ratePlayerCard({configId:t.guid,evolutionLevel:i,level:s-1})},n.ratePlayerCard=function(t){var i=e.data.cards.battle.find(t.configId),a=n.tierToMultiplier(i&&i.tier||""),o=r(i&&i.rarityType||e.RarityType.Common,t.evolutionLevel,t.level+1,a);return o},n.ratePlayerHeroAbility=function(r){return t(r.hero,e.AbilityType[r.type])},n.ratePlayerHeroHitPoints=function(r){return t(r.hero,"HP")*r.level/e.MaxLevel},n.tierToMultiplier=function(e){return"OP"==e?1.2:"S"==e?1:"A"==e?.8:"B"==e?.6:"C"==e?.4:"D"==e?.2:.5},n}();e.PowerRating=T})(bh||(bh={}));var bh;(function(e){var t=function(t){function r(r,n){void 0===n&&(n=!1);var i=t.call(this)||this;i.card=r,i.evos=[];var a=r.mats.map(function(t){return e.data.ItemRepo.find(t.trim())}).filter(function(e){return!!e}).sort(e.utils.sort.byRarity);return[0,1,2,3,4].slice(0,r.rarityType+1).slice(n?r.evo:0).forEach(function(t){var n=e.ItemRepo.sandsOfTime;i.addItem(t,e.data.getMinSotNeeded(r.rarityType,t),e.data.getMaxSotNeeded(r.rarityType,t),n.name),a.forEach(function(n){i.addItem(t,0,e.data.getMaxMatNeeded(r.rarityType,t,n.rarityType),n.name)})}),i}return __extends(r,t),Object.defineProperty(r.prototype,"lower",{get:function(){return this.card.lower},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"name",{get:function(){return this.card.name},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rarityType",{get:function(){return this.card.rarityType},enumerable:!0,configurable:!0}),r.prototype.addItem=function(t,r,n,i){var a=this.evos[t]||(this.evos[t]={evoFrom:t,evoTo:t+1,items:[]}),o={item:e.data.ItemRepo.find(i),min:r,max:n};a.items.push(o)},Object.defineProperty(r.prototype,"common",{get:function(){var t=this;return this.fromCache("common",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Common});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uncommon",{get:function(){var t=this;return this.fromCache("uncommon",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Uncommon&&"Sands of Time"!=t.item.name});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rare",{get:function(){var t=this;return this.fromCache("rare",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.Rare});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"superRare",{get:function(){var t=this;return this.fromCache("superRare",function(){var r=t.all.find(function(t){return t.item.rarityType==e.RarityType.SuperRare});return r&&r.item})},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inventoryItems",{get:function(){return[this.common,this.uncommon,this.rare,this.superRare]},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"all",{get:function(){var e=this;return this.fromCache("recipeItems",function(){var t=[];return e.evos.forEach(function(e){e.items.forEach(function(e){var r=t.find(function(t){return t.item==e.item});r||t.push(r={item:e.item,min:0,max:0}),r.min+=e.min,r.max+=e.max})}),t})},enumerable:!0,configurable:!0}),r.prototype.getItem=function(e){return this.all.find(function(t){return t.item.name==e.name})},r.prototype.getMaxNeeded=function(t){var r=this.getItem(t),n=r&&r.max,i=this.card instanceof e.PlayerBattleCard?this.card.count:1;return n*i},r}(e.Cacheable);e.Recipe=t})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(t){var r;(function(t){function r(){return g.slice()}function n(){return g.filter(function(e){return e.brag})}function i(e){return g.find(function(t){return t.guid==e})}function a(e,t){var r=e.toLowerCase();return void 0===t?g.find(function(e){return e.lower==r}):g.find(function(e){return e.rarityType===t&&e.lower==r})}function o(e){return e+1}function s(t,r){return r==c(e.RarityType[(t||"").replace(/ /,"")])}function u(e,t){void 0===t&&(t=0);var r=String(e),n=r.split(".");return 1==n.length||t<1?+n[0]:+(n[0]+"."+n[1].slice(0,t))}function l(e,t,r){return(t-e)/(c(r)-1)}function c(e){return[10,20,35,50,50][e]}function d(e){return[.8,.85,.88,.9,1][e]}function p(e){var t=i(e.configId);if(!t)return 0;var r=t.minValues[0][e.evolutionLevel],n=l(t.minValues[0].slice().pop(),t.maxValues[0],t.rarityType);return Math.floor(r+n*e.level)}function f(){return b||(b=new Promise(function(t){var r=(e.TSV||{})[String(h)];r?t(y(r)):e.Repo.fetchTsv(null,h).then(function(e){return t(y(e))},function(){return t(g)})})),b}function y(t){return g=e.Repo.mapTsv(t)}var h=1325382981,g=[];t.getAll=r,t.getBrag=n,t.find=i,t.findByName=a,t.getMaxEvo=o,t.isMaxLevel=s,t.truncDecimal=u,t.calcDelta=l,t.levelsPerRarity=c,t.evoMultiplier=d,t.calculateValue=p;var b;t.init=f})(r=t.battle||(t.battle={}))})(r=t.cards||(t.cards={}))})(t=e.data||(e.data={}))})(bh||(bh={}));var bh;(function(e){function t(e){return 2*e}function r(e){return Math.max(e-1,0)}function n(e,t){return"Jinx"==e.name?Math.max(t-29,0):Math.max(t-14,0)}function i(e,t){return"Jinx"==e.name?Math.max(t-14,0):Math.max(t-29,0)}function a(t){switch(t.type){case e.AbilityType.Active:return n(t.hero,t.level);case e.AbilityType.Passive:return i(t.hero,t.level);case e.AbilityType.Trait:return r(t.level)}}function o(t){switch(t.type){case e.AbilityType.Active:return n(t.hero,e.MaxLevel);case e.AbilityType.Passive:return i(t.hero,e.MaxLevel);case e.AbilityType.Trait:return r(e.MaxLevel)}}function s(t,a){switch(a){case e.AbilityType.Active:return n(t,e.MaxLevel);case e.AbilityType.Passive:return i(t,e.MaxLevel);case e.AbilityType.Trait:return r(e.MaxLevel)}}function u(t){return String(t)in e.ElementType}function l(t){return String(t).replace(/ /g,"")in e.RarityType}e.getMaxLevel=t,e.getMaxTrait=r,e.getMaxActive=n,e.getMaxPassive=i,e.getAbilityLevelCap=a,e.getAbilityLevelMax=o,e.MaxFame=45,e.MaxLevel=t(e.MaxFame),e.getAbilityMaxLevel=s,e.isElement=u,e.isRarity=l;var c;(function(t){function r(e){var t=[];return Array.isArray(e)&&3==e.length&&e.forEach(function(e){var r=Object.keys(e)||[],n=r[0]||"0",i=e[n],a=Object.keys(i)||[],s=a[0]||"",u=i[s]||null;o(u)&&t.push(u)}),t}function n(e){return e&&e.guilds&&e.currentWar&&!0}function i(e){return e&&e.playerGuild&&e.members&&!0}function a(e){return r(e).length&&!0}function o(e){return e&&e.id&&e.firstPlayedVersion&&!0}function s(e){return e&&Array.isArray(e)&&!e.map(u).includes(!1)}function u(e){return e&&e.playerId&&e.archetypeLevels&&!0||!1}function l(){return c||(c=Promise.all([t.cards.battle.init(),t.guilds.init()].concat(e.Repo.init()))),c}t.BoosterCardRepo=new e.Repo(1709781959,!0),t.HeroRepo=new e.HeroRepo,t.ItemRepo=new e.ItemRepo,t.PlayerRepo=new e.Repo,t.WildCardRepo=new e.Repo(2106503523,!0),t.arenaToPlayers=r,t.isGuildWar=n,t.isGuild=i,t.isArena=a,t.isPlayer=o,t.isGuildMembers=s,t.isGuildPlayer=u;var c;t.init=l})(c=e.data||(e.data={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){function r(e,t){return[[1],[1,2],[1,2,4],[1,2,4,5],[1,2,3,4,5]][e||0][t||0]}function n(e){return r(e.rarityType,e.evo)}function i(e){for(var n=t.cards.battle.getMaxEvo(e.rarityType),i=0,a=e.evo;a<n;a++)i+=r(e.rarityType,a);return i}function a(e,t){return[[1e3],[3700,11300],[4200,19200,49e3],[25e3,44e3,7e4,155e3],[45e3,9e4,18e4,36e4,54e4]][e][t]}function o(t,r){var n=e.ItemRepo.sandsOfTime;return a(t,r)+l(t,r)*e.ItemRepo.getValue(n.itemType,n.rarityType)}function s(t,r){var n=a(t,r),i=e.ItemRepo.sandsOfTime,o=c(t,r)*e.ItemRepo.getValue(i.itemType,i.rarityType),s=[0,1,2,3].map(function(e){return p(t,r,e)}),u=s.map(function(t,r){return t*e.ItemRepo.getValue(e.ItemType.EvoJar,r)}),l=u.reduce(function(e,t){return e+t},0),d=b(t,r)*e.ItemRepo.getValue(e.ItemType.Rune,e.RarityType.Rare),f=y(t,r)*e.ItemRepo.getValue(e.ItemType.Crystal,e.RarityType.Uncommon);return n+o+l+d+f}function u(r,n){for(var i=0,a=(t.cards.battle.find(r.configId)||{}).rarityType||0,o=e.data.cards.battle.getMaxEvo(a),u=+n.split(/\./)[0];u<o;u++)i+=s(a,u);return i}function l(e,t){return[[0],[2,5],[5,10,20],[10,20,30,40],[20,30,40,60,60]][e||0][t||0]}function c(e,t){return[[10],[12,15],[15,20,30],[20,30,40,60],[30,40,60,80,100]][e||0][t||0]}function d(r,n){for(var i=0,a=(t.cards.battle.find(r.configId)||{}).rarityType||0,o=e.data.cards.battle.getMaxEvo(a),s=+n.split(/\./)[0];s<o;s++)i+=c(a,s);return i}function p(e,t,r){return([[[12]],[[12,2],[12,6,2]],[[14,2],[26,10,4],[,14,8,6]],[[26,6,2],[40,20,12],[,26,16,8],[,26,20,12]],[[40,20,12],[,26,16,8],[,30,24,12],[,36,30,16]]][e][t]||[])[r]||0}function f(t,r){return t==e.RarityType.Legendary&&4==r?30:0}function y(t,r){return t==e.RarityType.Legendary&&4==r?60:0}function h(r,n){for(var i=0,a=(t.cards.battle.find(r.configId)||{}).rarityType||0,o=e.data.cards.battle.getMaxEvo(a),s=+n.split(/\./)[0];s<o;s++)i+=t.getMaxCrystalsNeeded(a,s);return i}function g(t,r){return t==e.RarityType.Legendary&&4==r?30:0}function b(t,r){return t==e.RarityType.Legendary&&4==r?60:0}function m(r,n){for(var i=0,a=(t.cards.battle.find(r.configId)||{}).rarityType||0,o=e.data.cards.battle.getMaxEvo(a),s=+n.split(/\./)[0];s<o;s++)i+=t.getMaxRunesNeeded(a,s);return i}t.wildsForEvo=r,t.getNextWildCardsNeeded=n,t.getMaxWildCardsNeeded=i,t.getBaseGoldNeeded=a,t.getMinGoldNeeded=o,t.getMaxGoldNeeded=s,t.calcMaxGoldNeeded=u,t.getMinSotNeeded=l,t.getMaxSotNeeded=c,t.calcMaxSotNeeded=d,t.getMaxMatNeeded=p,t.getMinCrystalsNeeded=f,t.getMaxCrystalsNeeded=y,t.calcMaxCrystalsNeeded=h,t.getMinRunesNeeded=g,t.getMaxRunesNeeded=b,t.calcMaxRunesNeeded=m})(t=e.data||(e.data={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(r){function n(e){return h.find(function(t){return t&&t.playerGuild&&t.playerGuild.id==e})}function i(e){return a(e).map(function(e){return n(e.guid)}).filter(function(e){return!!e})}function a(e){var t=(e||"").toLowerCase();return y.filter(function(e){return e.lower==t})}function o(e){return e&&y.filter(function(t){return t.parent===e})||[]}function s(e){return y.filter(function(t){return t.guid==e})[0]||null}function u(){return y.slice()}function l(e){e&&e.leaderboardEntries&&e.leaderboardEntries.forEach(function(e){var t=s(e.id);t||(c(e.id,e.name),t=s(e.id)),t.leaderBoardEntry=e})}function c(r,i,a){if(i){var o=y.find(function(e){return e.guid==r});o?(o.lower=(i||"").toLowerCase(),o.name=i||"",o.parent=o.parent||a||null):y.push({guid:r,lower:(i||"").toLowerCase(),name:i||null,parent:a||null})}else if(Array.isArray(r)){var u=r[0].guildId,l=s(u),d=l&&n(l.guid);d?d.members=r:h.push({playerGuild:{members:r.map(function(e){return{playerId:e.playerId}}),id:u,name:l.name},members:r})}else{var p=r,f=p.playerGuild;if(f){c(f.id,f.name);var g=h.findIndex(function(e){return e.playerGuild.id==f.id});-1<g?h[g]=r:h.push(r),p.members.forEach(function(r){return t.PlayerRepo.put(new e.Player(r))})}}}function d(){return g||(g=new Promise(function(t){var r=(e.TSV||{})[String(f)];r?t(p(r)):e.Repo.fetchTsv(null,f).then(function(e){return t(p(e))},function(){return t(y)})})),g}function p(t){return y=e.Repo.mapTsv(t)}var f=496437953,y=[],h=[];r.findByGuid=n,r.filterByName=i,r.filterNamesByName=a,r.filterNamesByParent=o,r.findNameByGuid=s,r.getNames=u,r.updateLeaderBoard=l,r.put=c;var g;r.init=d})(r=t.guilds||(t.guilds={}))})(t=e.data||(e.data={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(r){function n(e){var t=l(e);return t[e]||(t=a(e)),t[e]||(t=s(e)),t[e]||(t=y),t}function i(e){return e&&e.playerGuild?(h[e.playerGuild.id]=e,a(e.playerGuild.id)):{}}function a(e){return h[e]?c(h[e].members)||{}:{}}function o(e){return g[e[0].guildId]=e.slice(),s(e[0].guildId)}function s(e){return g[e]?c(g[e])||{}:{}}function u(e){return e.guilds.forEach(function(t){return b[t.id]=e}),l(e.guilds[0].id)}function l(e){return b[e]?f(b[e])||{}:{}}function c(r){var n=(t.HeroRepo.sorted,{}),i=r[0].guildId;return n[i]=r.slice().sort(e.utils.sort.byPositionThenName).map(d).join("\n"),n}function d(r,n){function i(t){var n=r.archetypeLevels[t.guid]+1,i=e.utils.truncateNumber(t.getHitPoints(n));return n?n+"|"+i+"|":"/|/|/"}function a(t){var r=o.heroes.find(function(e){return t.guid==e.guid}),n=r?r.level:"/",i=r?e.utils.truncateNumber(r.hitPoints):"/",a=r&&r.isOp?"-":"",s=r?r.powerPercent+"%":"/";return n+"|"+i+"|"+a+s}var o=t.PlayerRepo.find(r.playerId),s=e.PositionType[r.position]+1,u=r.fameLevel+1,l=t.HeroRepo.sorted.map(o?a:i),c=n?n+1:"GL";return[c,u,r.name,s].concat(l).join("\t")}function p(e,t){var r=e.currentWar.battles,n=0,i=0,a=0,o=0,s=0;return t&&r.forEach(function(e){e.initiator.playerId==t.playerId&&(e.initiator.winner?n++:i++,e.completedBragId&&o++,s+=e.initiator.totalScore),e.opponent.playerId==t.playerId&&(e.opponent.winner&&a++,s+=e.opponent.totalScore)}),{winCount:n,lossCount:i,dwCount:a,score:s,brags:o}}function f(r){function n(e,t,n){var i=d(t,e),a=p(r,t);return i+"\t"+a.winCount+"\t"+a.lossCount+"\t"+a.dwCount+"\t"+a.score}var i=(t.HeroRepo.sorted,r.guilds[0]),a=r.guilds.find(function(e){return e.id!=i.id}),o=r.members[i.id].sort(e.utils.sort.byPositionThenName),s=r.members[a.id].sort(e.utils.sort.byPositionThenName),u=o.map(function(e,t){return n(t,e,s[t])}).join("\n"),l=s.map(function(e,t){return n(t,e,o[t])}).join("\n"),c={};return c[i.id]=u,c[a.id]=l,c}var y={};r.getReport=n;var h={};r.putGuild=i,r.getGuildReport=a;var g={};r.putGuildMembers=o,r.getGuildMembersReport=s;var b={};r.putGuildWar=u,r.getGuildWarReport=l})(r=t.reports||(t.reports={}))})(t=e.data||(e.data={}))})(bh||(bh={}));var bh;(function(e){function t(e){return a=a||e,o||(o=new Promise(function(e,t){r(e,t),i(function(){e()})}))}function r(e,t){if(!u){if(++l>60)return t("60 tries");if(!(a&&a.jQuery&&a.document&&a.document.body))return void(u||setTimeout(r,1500,e,t));a.jQuery(function(){s.forEach(function(e){return e()})}),e()}}function n(){return c}function i(e){return e?"function"!=typeof e||a&&a.jQuery?(a&&a.jQuery||n)(e):s.push(e):a?a.jQuery||n:n}var a,o,s=[],u=!1,l=0;e.loaded=t;var c={on:n,val:n};e.$=i;var d;(function(t){function r(){e.data.init().then(function(){i("body").on("click change","[data-action]",o)})}function n(e,t){e&&String(t).length&&i('.brain-hud-inventory-buttons > button[data-action="toggle-'+e+'"][data-'+e+'="'+t+'"]').toggleClass("active");var r=i('.brain-hud-inventory-buttons > [data-action="toggle-element"].active').toArray().map(function(e){return e.getAttribute("data-element")}),n=i('.brain-hud-inventory-buttons > [data-action="toggle-klass"].active').toArray().map(function(e){return e.getAttribute("data-klass")}),a=i('.brain-hud-inventory-buttons > [data-action="toggle-type"].active').toArray().map(function(e){return e.getAttribute("data-type")});i("#brain-hud-inventory-items-container > div").hide(),r.length||n.length||a.length?i("#brain-hud-inventory-items-container > div").each(function(e,t){var o=i(t),s=!r.length||r.includes(String(o.data("elementType"))),u=!n.length||n.includes(String(o.data("klassType")))||n.includes(o.data("brag")),l=!a.length||a.includes(o.data("type"))||a.includes(String(o.data("itemType")));
s&&u&&l&&o.show()}):i('#brain-hud-inventory-items-container > div[data-hud="true"]').show()}function a(t){var r=i("div.brain-hud-scouter-player"+(t?'[data-guid="'+t+'"]':".active")),n=["element-klass","power-asc","hp-asc","name"],a=n.indexOf(r.data("sort")||"element-klass"),o=n[a+1]||"element-klass";r.data("sort",o),t||(t=r.data("guid"));var s=e.data.PlayerRepo.find(t),u=s.heroes.sort(function(t,r){if("power-asc"==o){var n=t.powerPercent,i=r.powerPercent;if(n!=i)return n<i?-1:1}if("hp-asc"==o){var a=t.hitPoints,s=r.hitPoints;if(a!=s)return a<s?-1:1}return"name"==o?e.utils.sort.byName(t,r):e.utils.sort.byElementThenKlass(t,r)});u.forEach(function(e){return r.find('[data-guid="'+t+"-"+e.guid+'"]').appendTo(r)})}function o(t){var r,o=i(t.target).closest("[data-action]"),s=o.data("action");switch(s){case"sort-heroes":a();break;case"refresh-guild":e.Messenger.instance.postMessage(e.Messenger.createMessage("refresh-guild",i("#brain-hud-scouter-guild-target").val()));break;case"refresh-player":e.Messenger.instance.postMessage(e.Messenger.createMessage("refresh-player",i("#brain-hud-scouter-player-target").val()));break;case"toggle-child":r=o.data("guid");var u=i('div[data-parent-guid="'+r+'"]').toggleClass("active").hasClass("active");i('button[data-action="toggle-child"][data-guid="'+r+'"]').text(u?"[-]":"[+]");break;case"toggle-element":n("element",o.data("element"));break;case"toggle-klass":n("klass",o.data("klass"));break;case"toggle-type":n("type",o.data("type"));break;case"toggle-scouter-guild":e.hud.guild.selectGuildReport();break;case"toggle-scouter-player":e.hud.player.selectPlayerReport();break;case"toggle-scouter-hero":var l=o.closest("[data-guid]"),c=l.find(".brain-hud-scouter-panel-content");c.toggleClass("active");break;case"toggle-hud":var d=i("div.brain-hud-main-container").toggleClass("active").hasClass("active");i("div#brain-hud-container").css("width",d?250:25),i("div.brain-hud-header>span.header")[d?"show":"hide"](),i('button.brain-hud-toggle[data-action="toggle-hud"]').text(d?"[-]":"[+]");break;case"toggle-guild-scouter":var d=i("textarea#brain-hud-scouter-guild-report").toggleClass("active").hasClass("active");i('button.brain-hud-toggle[data-action="toggle-guild-scouter"]').text(d?"[-]":"[+]");break;case"toggle-player-scouter":var d=i("div#brain-hud-scouter-player-report").toggleClass("active").hasClass("active");i('button.brain-hud-toggle[data-action="toggle-player-scouter"]').text(d?"[-]":"[+]");break;case"toggle-inventory":var d=i("div.brain-hud-inventory-container").toggleClass("active").hasClass("active");i('button.brain-hud-toggle[data-action="toggle-inventory"]').text(d?"[-]":"[+]");break;default:console.log(s)}}t.init=r,t.toggle=n})(d=e.events||(e.events={}))})(bh||(bh={}));var bh;(function(e){function t(){return u||(u=String(location.href).toLowerCase().includes("battlehand-hud/")?".":e.host),u}function r(e,t,r){var n="",i=t?'class="'+t+'"':"",r=r?'style="'+r+'"':"";return e.includes("glyphicons-82-refresh")&&(n="onerror=\"bh.$(this).replaceWith('&#8634;')\""),'<img src="'+e+'" '+i+" "+r+" "+n+"/>"}function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s.apply(void 0,e))}function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s.apply(void 0,e),"icon-12")}function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s.apply(void 0,e),"icon-20")}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(s.apply(void 0,e),"grayscale")}function s(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];for(var n=e.slice(),i=l[n.shift()];n.length;)i=i[n.shift()];return i||(i=t()+"/images/"+e.join("/")+".png"),i}var u;e.getImg=n,e.getImg12=i,e.getImg20=a,e.getImgG=o,e.getSrc=s;var l;(function(e){var t;(function(e){var t;(function(e){})(t=e.blank||(e.blank={}));var r;(function(e){})(r=e.icons||(e.icons={}))})(t=e.battlecards||(e.battlecards={}));var r;(function(e){})(r=e.cardtypes||(e.cardtypes={}));var n;(function(e){})(n=e.classes||(e.classes={}));var i;(function(e){})(i=e.crystals||(e.crystals={}));var a;(function(e){})(a=e.effects||(e.effects={}));var o;(function(e){})(o=e.elements||(e.elements={}));var s;(function(e){})(s=e.evojars||(e.evojars={}));var u;(function(e){})(u=e.heroes||(e.heroes={}));var l;(function(e){})(l=e.icons||(e.icons={}));var c;(function(e){})(c=e.keys||(e.keys={}));var d;(function(e){})(d=e.misc||(e.misc={}));var p;(function(e){})(p=e.runes||(e.runes={}));var f;(function(e){})(f=e.skills||(e.skills={}))})(l=e.images||(e.images={}))})(bh||(bh={}));var bh;(function(e){e.isHud=!1,e.isListener=!1,e.isLocal=!1;var t;(function(t){var r;(function(r){function n(t){e.Messenger.isValidMessage(t)?c.forEach(function(e){if(e&&e.action==t.action&&e.callbackfn)try{e.callbackfn(t)}catch(e){console.error(t.action,e)}}):console.log("invalid message",t)}function i(e,t,r){c.push({action:e,url:t,callbackfn:r})}function a(r,i){return void 0===i&&(i="http://brains.sth.ovh"),new Promise(function(a,s){var u=String(r&&r.location&&r.location.href||"").toLowerCase();e.isLocal=u.includes("battlehand-hud/default.htm")||u.includes("battlehand-hud/iframe.htm"),e.isHud=u.includes("battlehand-hud/default.htm")||u.startsWith("http://www.kongregate.com/games/anotherplaceprod/battlehand-web"),e.isListener=u.includes("battlehand-hud/iframe.htm")||u.startsWith("http://game261051.konggames.com/gamez/"),e.host=i,e.isHud?(r.bh=e,XmlHttpRequest.attach(r),e.loaded(r).then(function(){e.Messenger.initialize(r,n),e.data.init().then(function(){t.render(),e.Messenger.instance.postMessage(e.Messenger.createMessage("hud-init","hud-init")),a(r)},function(){return s("data.init rejected")})},function(e){return s("loaded(win) rejected: "+e)})):e.isListener?(l.setResolve(r,a),XmlHttpRequest.attach(r,o),e.Messenger.initialize(r,n)):s("not hud nor listener")})}function o(){u(this)}function s(e){var t=c.find(function(t){return e.includes(t.url)});return t&&t.action||null}function u(t){if(t.readyState==XmlHttpRequest.DONE){var r=t.requestUrl.match(/\?player=([a-z0-9]{8}(?:\-[a-z0-9]{4}){3}\-[a-z0-9]{12})&sessionKey=([a-z0-9]{32})(?:&guild(?:Id)?=([a-z0-9]{8}(?:\-[a-z0-9]{4}){3}\-[a-z0-9]{12}))?/);if(r){var n=s(t.requestUrl),i=r[1],a=r[2],o=r[3],u={action:n,playerGuid:i,sessionKey:a,guildGuid:o,data:t.responseJSON};if(!n)return;l.resolveListener(),e.Messenger.instance.postMessage(u)}}}var l;(function(e){function t(e,t){a=e,o=t}function r(){s=!0,i()}function n(){u=!0,i()}function i(){l||s&&u&&(o(a),l=!0)}var a,o,s=!1,u=!1,l=!1;e.setResolve=t,e.resolveHud=r,e.resolveListener=n})(l||(l={}));var c=[{action:"hud-init",url:null,callbackfn:l.resolveHud}];r.addAction=i,r.init=a,r.handleReadyStateChange=u})(r=t.listener||(t.listener={}))})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(r){function n(r){e.$('#brain-hud-scouter-player-target > option[value="arena"]').length||e.$("#brain-hud-scouter-player-target").children().first().after("<option value='arena'>Arena Opponents</option>");var n=r.data,i=e.data.arenaToPlayers(n);i.forEach(function(r,n){return t.scouter.loadPlayer(new e.Player(r,!0),n)}),e.$("#brain-hud-scouter-player-target").val("arena"),t.player.selectPlayerReport()}t.listener.addAction("get-arena-matches","/v1/matchmaking/getmatches?",n)})(r=t.arena||(t.arena={}))})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(r){function n(){var t=e.$("div.brain-hud-scouter-guild-container");if(!t.length){var r=e.Player.me.canScout?'<textarea id="brain-hud-scouter-guild-report" rows="1" type="text" class="active"></textarea>':"";e.$("div.brain-hud-scouter-player-container").before('<div class="brain-hud-scouter-guild-container"><button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-guild-scouter">[-]</button><button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="refresh-guild">'+e.getImg12("icons","glyphicons-82-refresh")+'</button><select id="brain-hud-scouter-guild-target" data-action="toggle-scouter-guild"></select>'+r+"</div>")}e.$("div.brain-hud-scouter-guild-container").addClass("active")}function i(t){var r=t.data,n=r&&r.playerGuild&&r.playerGuild.id,i=r&&r.playerGuild&&r.playerGuild.name;n&&i&&(e.data.guilds.put(n,i),e.data.reports.putGuild(r),c(n))}function a(t){var r=t.data;r.forEach(function(t){return e.data.guilds.put(t.id,t.name)})}function o(t){var r=t.data,n=r[0].guildId;e.data.reports.putGuildMembers(r),c(n)}function s(e){c(e.guildGuid)}function u(t){var r=t.data;r&&r.guilds&&(r.guilds.forEach(function(t){return e.data.guilds.put(t.id,t.name)}),e.data.reports.putGuildWar(r),r.guilds.forEach(function(e){return c(e.id)}))}function l(t){var r=t.data;e.data.guilds.updateLeaderBoard(r),d()}function c(t){var r=e.data.guilds.findNameByGuid(t);if(!r)return console.log("guildName not found: "+t);var i=e.Player.me,a=i&&i.guildParent||null,o=a&&e.data.guilds.filterNamesByParent(a)||[],s=i&&i.canScout,u=i&&i.guildGuid==t;if(o.find(function(e){return e.guid==t})||s||u){n();var l=e.$("#brain-hud-scouter-guild-target");l.find('option[value="'+t+'"]').length||(l.append('<option value="'+t+'">'+r.name+"</option>"),l.children().toArray().filter(function(e){return e.value!=i.guildGuid}).sort(function(e,t){return e.text<t.text?-1:e.text==t.text?0:1}).forEach(function(e){return l.append(e)})),l.val(t),f()}}function d(){e.$("#brain-hud-scouter-guild-target").children().toArray().forEach(p)}function p(t){if(t&&t.value){var r=t.value,n=e.data.guilds.findNameByGuid(r),i=n&&n.leaderBoardEntry||null,a=i&&"#"+(i.rank+1)+" "||"",o=i&&(i.wins||i.losses)&&"("+n.leaderBoardEntry.wins+"/"+n.leaderBoardEntry.losses+") "||"",s=""+a+o+n.name;t.text=s}}function f(){var t=e.$("#brain-hud-scouter-guild-target").val();p(e.$('#brain-hud-scouter-guild-target > option[value="'+t+'"]')[0]),e.$("#brain-hud-scouter-guild-report").val(e.data.reports.getReport(t)[t]||"")}function y(t,r){var n="https://battlehand-game-kong.anotherplacegames.com/v1/guild/getguilds?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&name="+t+"&joinableonly=False&language=&minfamelevel=2&maxfamelevel=44";return new Promise(function(t,i){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?void XmlHttpRequest.getJSON(n).then(function(e){return e&&Array.isArray(e)?void h(e,r).then(t,i):i("invalid json")},i):i("not initialized")})}function h(e,r){return new Promise(function(n,i){function a(){(o=s.shift())?setTimeout(function(){return g(o.id,r).then(a,a)},t._delayMS):n()}var o,s=e.slice();a()})}function g(r,n){var i="https://battlehand-game-kong.anotherplacegames.com/v1/guild/getmembers?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&guild="+r;return e.isLocal&&(i="./json/"+r+".json"),new Promise(function(a,o){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?r?void XmlHttpRequest.getJSON(i).then(function(r){if(!r||!Array.isArray(r))return o("invalid json");if(e.Messenger.instance.postMessage(e.Messenger.createMessage("get-guild-members",r)),n){var i=r.map(function(e){return e.playerId});t.player.playersGet(i).then(a,a)}else a(r)},o):o("no guild id"):o("not initialized")})}function b(t,r){void 0===t&&(t=0),void 0===r&&(r=13);var n="https://battlehand-game-kong.anotherplacegames.com/v1/guildwars/getrange?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&start="+t+"&count="+r;return e.isLocal&&(n="./json/top_guilds.json"),new Promise(function(t,r){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?void XmlHttpRequest.getJSON(n).then(function(n){return n&&n.leaderboardEntries?(e.Messenger.instance.postMessage(e.Messenger.createMessage("get-leaderboard",n)),void t(n)):r("invalid json")},r):r("not initialized")})}r.addGuildReport=c,r.selectGuildReport=f,t.listener.addAction("get-guild","/v1/guild/get?",i),t.listener.addAction("get-guild-members","/v1/guild/getmembers?",o),t.listener.addAction("get-guild-war","/v1/guildwars/get?",u),t.listener.addAction("get-leaderboard","/v1/guildwars/getrange?",l),t.listener.addAction("get-guildsearch","/v1/guild/getguilds?",a),t.listener.addAction("get-leaderboard-members","/v1/guildwars/getguildmembersrange?",s),r.searchGuilds=y,r.guildsGetMembers=h,r.guildGetMembers=g,r.leaderBoardGet=b,t.listener.addAction("refresh-guild",null,function(e){g(e.data,!0)})})(r=t.guild||(t.guild={}))})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){t._delayMS=500;var r;(function(r){function n(t){t.isExtended&&(e.$("#brain-hud-inventory").addClass("active"),e.data.PlayerRepo.put(t),e.$("#brain-hud-inventory-items-container").html("").append(t.boosterCards.map(function(e){return e.rowHtml})).append(t.battleCards.map(function(e){return e.rowHtml})).append(t.inventory.sort(e.utils.sort.byName).map(function(e){return e.rowHtml})).append(t.wildCards.map(function(e){return e.rowHtml})).append(t.boosterRowHtml).append(t.fragmentsRowHtml).append(t.gemsRowHtml).append(t.goldRowHtml).append(t.raidRowHtml).append(t.wildCardRowHtml),e.events.toggle())}function i(r){var i=r.data,o=new e.Player(i),s=e.$("#brain-hud-scouter-player-target");if(e.$('#brain-hud-scouter-player-target > option[value="'+o.guid+'"]').length||(s.append('<option value="'+o.guid+'">'+(o.isFullMeat?"&#9734; ":"")+e.utils.htmlFriendly(o.name)+" ("+o.powerPercent+"%)</option>"),s.children().toArray().slice(1).sort(function(e,t){return e.text<t.text?-1:e.text==t.text?0:1}).forEach(function(e){return s.append(e)})),e.data.PlayerRepo.put(o),t.scouter.loadPlayer(o),o.isMe){n(o);var u=o.guilds;u.length&&t.guild.addGuildReport&&u.forEach(function(e){return t.guild.addGuildReport(e.guid)})}s.val(i.id),a(),t.guild.selectGuildReport()}function a(){e.$("div.brain-hud-scouter-player-container").addClass("active"),e.$("#brain-hud-scouter-player-report").show(),e.$("div.brain-hud-scouter-player").removeClass("active");var t=e.$("#brain-hud-scouter-player-target").val();"arena"==t?(e.$('div.brain-hud-scouter-player[data-guid="arena-0"]').addClass("active"),e.$('div.brain-hud-scouter-player[data-guid="arena-1"]').addClass("active"),e.$('div.brain-hud-scouter-player[data-guid="arena-2"]').addClass("active")):e.$('div.brain-hud-scouter-player[data-guid="'+t+'"]').addClass("active")}function o(e){return new Promise(function(r,n){function i(){(a=o.shift())?setTimeout(function(){return s(a).then(i,i)},t._delayMS):r()}var a,o=e.slice();i()})}function s(t){var r="https://battlehand-game-kong.anotherplacegames.com/v1/player/getplayerinfo?player="+e.Messenger.ActivePlayerGuid+"&sessionKey="+e.Messenger.ActiveSessionKey+"&id_requested_player="+t;return e.isLocal&&(r="./json/"+t+".json"),new Promise(function(n,i){return e.Messenger.ActivePlayerGuid&&e.Messenger.ActiveSessionKey?t?void XmlHttpRequest.getJSON(r).then(function(t){return t?(e.Messenger.instance.postMessage(e.Messenger.createMessage("get-player",t)),void n(t)):i("invalid json")},i):i("no player id"):i("not initialized")})}r.loadPlayer=n,r.addPlayerReport=i,r.selectPlayerReport=a,t.listener.addAction("get-player","/v1/player/get?",i),t.listener.addAction("get-player","/v1/player/getplayerinfo?",i),r.playersGet=o,r.playerGet=s,t.listener.addAction("refresh-player",null,function(e){console.log("refresh-player: "+(e&&e.data)),s(e.data)})})(r=t.player||(t.player={}))})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){function r(){i(),o(),e.events.init()}function n(){var t='<style id="brain-hud-styles" type="text/css">\ndiv.brain-hud-container { font-size:8pt; position:fixed; top:0; right:0; width:275px; background:#FFF; color:#000; border:2px solid #000; z-index:9999; padding:2px; max-height:'+(jQuery(window).height()-10)+'px; overflow:auto; }\ndiv.brain-hud-container div { clear:both; }\ndiv.brain-hud-container table { width:100%; margin:0; padding:0; border:0; }\ndiv.brain-hud-container td { padding:0; margin:0; border:0; }\ndiv.brain-hud-container select { width:205px; }\ndiv.brain-hud-container textarea { width:265px; font-size:8pt; display:none; }\n\ndiv.brain-hud-container .Air { background-color:#f3f3f3; }\ndiv.brain-hud-container .Earth { background-color:#e0eed5; }\ndiv.brain-hud-container .Fire { background-color:#fce5cd; }\ndiv.brain-hud-container .Spirit { background-color:#f3e2f6; }\ndiv.brain-hud-container .Water { background-color:#deeaf4; }\ndiv.brain-hud-container .grayscale { filter: grayscale(100%); }\n\ndiv.brain-hud-header { text-align:center; font-weight:bold; }\n\ndiv.brain-hud-main-container,\ndiv.brain-hud-scouter-guild-container,\ndiv.brain-hud-scouter-player-container,\ndiv.brain-hud-scouter-player,\ndiv.brain-hud-scouter-panel-content,\ndiv.brain-hud-inventory,\ndiv.brain-hud-inventory-container,\ndiv.brain-hud-child-scroller { display:none; }\n\ndiv.brain-hud-scouter-panel-content,\ndiv.brain-hud-child-scroller { padding-left:10px; }\n\ndiv.brain-hud-scouter-player-report { display:none; padding:0 2px; text-align:left; }\ndiv.brain-hud-scouter-player > div.player-name { font-size:10pt; font-weight:bold; text-align:center; }\n\ndiv.brain-hud-scouter-panel-header { padding:2px 0 0 0; }\ndiv.brain-hud-scouter-panel-header > button { cursor:default; border:0; width:265px; text-align:left; padding:0; margin:0; }\ndiv.brain-hud-scouter-panel-header > button[data-action] { cursor:pointer; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-icon { display:inline-block; width:20px; text-align:center; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-level { display:inline-block; width:30px; text-align:right; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-name { display:inline-block; width:60px; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-hp { display:inline-block; width:50px; text-align:center; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-rating-bar { display:inline-block; width:60px; }\ndiv.brain-hud-scouter-panel-header > button > span.hero-rating { display:inline-block; width:35px; text-align:right; font-size:8pt; vertical-align:top; }\n\ndiv.brain-hud-inventory-buttons { text-align:center; }\n\ndiv.brain-hud-container .active { display:block; }\n\ndiv.brain-hud-container .star { color: darkgoldenrod; text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black; }\ndiv.brain-hud-container .evo-star { color: gold; text-shadow: -1px 0 black, 0 1px black, 1px 0 black, 0 -1px black; }\n\ndiv.brain-hud-container img { height:16px; width:16px; }\ndiv.brain-hud-container img.icon-12 { height:12px; width:12px; }\ndiv.brain-hud-container img.icon-20 { height:20px; width:20px; }\n\ndiv.brain-hud-child-scroller { max-height:180px; overflow:auto; }\ndiv.brain-hud-scouter-panel-content.active,\ndiv.brain-hud-child-scroller.active { border:1px solid #aaa; border-radius:10px; }\n\ndiv.progress { margin-bottom:0; height:10px; }\ndiv.progress > div.progress-bar { line-height:10px; font-size:8px; font-weight:bold; clear:none; }\n\ndiv.brain-hud-container .badge,\ndiv.brain-hud-container .bs-btn-group-xs > .bs-btn,\ndiv.brain-hud-container .bs-btn-xs { font-size:11px; }\n\ndiv.brain-hud-container .badge.bg-success { background-color:#3c763d; }\ndiv.brain-hud-container .badge.bg-danger { background-color:#a94442; }\ndiv.brain-hud-container [data-action="sort-heroes"] { cursor:pointer; }\n</style>';e.$("head").append(t)}function i(){e.$().get("https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css").then(function(t){e.$("head").append('<style type="text/css">'+t.replace(/\.btn/g,".bs-btn")+"</style>"),n()})}function a(t,r,n,i){return'<button class="bs-btn bs-btn-default brain-hud-button" type="button" data-action="toggle-'+t+'" data-'+t+'="'+r+'">'+e.getImg(n,i||r)+"</button>"}function o(){var t='<div class="brain-hud-header">\n\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-hud">[-]</button>\n\t<span class="header">The Brain BattleHand HUD</span>\n</div>\n<div class="brain-hud-main-container active">\n\t<div class="brain-hud-scouter-player-container">\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-player-scouter">[-]</button>\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="refresh-player">'+e.getImg12("icons","glyphicons-82-refresh")+'</button>\n\t\t<select id="brain-hud-scouter-player-target" data-action="toggle-scouter-player"></select>\n\t\t<div id="brain-hud-scouter-player-report" class="brain-hud-scouter-player-report active"></div>\n\t</div>\n\t<div id="brain-hud-inventory" class="brain-hud-inventory">\n\t\t<strong>Inventory</strong>\n\t\t<button class="bs-btn bs-btn-link bs-btn-xs brain-hud-toggle pull-right" data-action="toggle-inventory">[-]</button>\n\t\t<div class="brain-hud-inventory-container active">\n\t\t\t<div class="text-center">\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons" role="group">\n\t\t\t\t\t'+a("element",e.ElementType.Air,"elements","Air")+"\n\t\t\t\t\t"+a("element",e.ElementType.Earth,"elements","Earth")+"\n\t\t\t\t\t"+a("element",e.ElementType.Fire,"elements","Fire")+"\n\t\t\t\t\t"+a("element",e.ElementType.Spirit,"elements","Spirit")+"\n\t\t\t\t\t"+a("element",e.ElementType.Water,"elements","Water")+"\n\t\t\t\t\t"+a("element",e.ElementType.Neutral,"elements","Loop")+'\n\t\t\t\t</div>\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons">\n\t\t\t\t\t'+a("klass",e.KlassType.Magic,"classes","Magic")+"\n\t\t\t\t\t"+a("klass",e.KlassType.Might,"classes","Might")+"\n\t\t\t\t\t"+a("klass",e.KlassType.Skill,"classes","Skill")+"\n\t\t\t\t\t"+a("klass","Brag","cardtypes")+"\n\t\t\t\t\t"+a("type",e.ItemType.Rune,"runes","Meteor")+"\n\t\t\t\t\t"+a("type",e.ItemType.Crystal,"crystals","Neutral")+'\n\t\t\t\t</div><br/>\n\t\t\t\t<div class="bs-btn-group bs-btn-group-xs brain-hud-inventory-buttons">\n\t\t\t\t\t'+a("type","BoosterCard","misc","Boosters")+"\n\t\t\t\t\t"+a("type","WildCard","cardtypes","WildCard")+"\n\t\t\t\t\t"+a("type",e.ItemType.EvoJar,"misc","EvoJars")+'\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div id="brain-hud-inventory-items-container" class="brain-hud-inventory-items-container"></div>\n\t\t</div>\n\t</div>\n</div>';e.$("body").append('<div id="brain-hud-container" class="brain-hud-container">'+t+"</div>")}t.render=r})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(t){function r(t){return e.$('div.brain-hud-scouter-player[data-guid="'+t+'"]').length||e.$("div#brain-hud-scouter-player-report").append('<div class="brain-hud-scouter-player" data-guid="'+t+'"></div>'),e.$('div.brain-hud-scouter-player[data-guid="'+t+'"]')}function n(t,n){void 0===n&&(n=-1);var a=t.isFullMeat?"&#9734;":"",o=t.powerPercent==t.averagePowerPercent?"":"; Avg "+t.averagePowerPercent+"%",s=t.isArena?"":' <span style="white-space:nowrap;">('+t.powerPercent+"%"+o+")</span>",u='<div class="player-name" data-action="sort-heroes">'+a+" "+e.utils.htmlFriendly(t.name)+" "+s+"</div>",l=t.heroes.sort(e.utils.sort.byElementThenKlass);l.forEach(function(r){var n=t.guid+"-"+r.guid,a=e.getImg("heroes",r.name),o=r.level==e.MaxLevel?r.isMeat?'<span class="evo-star">&#9734;</span>':'<span class="star">&#9734;</span>':"("+r.level+")",s=r.powerPercent,l=r.isOp?"background-color:pink;":"",c=s<25?"progress-bar-info":s<50?"progress-bar-success":s<75?"progress-bar-warning":"progress-bar-danger",d='<div class="progress" style="'+l+'"><div class="progress-bar '+c+'" style="width:'+s+'%;"><span></span></div></div>',p='<span class="hero-icon">'+a+"</span>"+('<span class="hero-name">'+r.name+"</span>")+('<span class="hero-level">'+o+"</span>")+('<span class="hero-hp">'+e.utils.truncateNumber(r.hitPoints)+" HP</span>")+('<span class="hero-rating-bar">'+d+"</span>")+('<span class="hero-rating">('+s+"%)</span>"),f="";if(t.isMe||t.isAlly){var y=r.playerHeroAbilities.map(function(t){var n=t.level,i=t.isCapped,a=t.isLocked,o=t.isMaxed,s=t.levelMax,u=a?"locked":o?"max":i?"capped":n+" / "+s,l=t.img+" "+t.name+" ("+u+")",c="";return o||(c+=t.materialHtml,c+=t.goldHtml),e.renderExpandable(r.guid+t.guid,l,c)}),h=r.deck.map(function(e){return e.rowHtml}).join("");f=""+y.join("")+h}u+=i(n,r.elementType,p,f,t.isMe||t.isAlly)}),r(n==-1?t.guid:"arena-"+n).html(u)}function i(t,r,n,i,a){var o='<button class="bs-btn bs-btn-link bs-btn-sm '+e.ElementType[r]+'" '+(a?'data-action="toggle-scouter-hero"':"")+">"+n+"</button>";return'<div class="brain-hud-scouter-panel" data-guid="'+t+'"><div class="brain-hud-scouter-panel-header">'+o+'</div><div class="brain-hud-scouter-panel-content">'+i+"</div></div>"}t.loadPlayer=n})(r=t.scouter||(t.scouter={}))})(t=e.hud||(e.hud={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){function r(e){return"#"+e.trim().toLowerCase().replace(/\W/g,"-")}function n(e){return e.trim().replace(/\W/g,"")}function i(){e.host="http://brains.sth.ovh",e.data.init().then(x),j("body").on("click",'[data-action="show-card"]',o),j("input.library-search").on("change keyup",u),j("button.library-search-clear").on("click",a);var t=j("#card-evolution div.tab-pane"),r=t.html();t.html(r).toArray().forEach(function(e,t){return j(e).find("h3").text("Evolution from "+t+" to "+(t+1))})}function a(){M=null,j("input.library-search").val(""),j('a[href="#card-table"] > span.badge').text(String(e.data.cards.battle.getAll().length)),j('a[href="#effect-table"] > span.badge').text(String(E.length)),j('a[href="#item-table"] > span.badge').text(String(e.data.ItemRepo.length)),j("tbody > tr[id]").show()}function o(t){var r=j(t.target),i=r.closest("tr"),a=i.attr("id"),o=e.data.cards.battle.find(a);j("div.modal-card").modal("show"),j("#card-name").html(o.name+" &nbsp; "+P(o).join(" ")),j("#card-tier").html(o.tier||""),j("#card-image").attr("src",e.getSrc("battlecards","blank",n(o.name))),j("#card-element").html((o.elementType==e.ElementType.Neutral?"":e.getImg20("elements",e.ElementType[o.elementType]))+" "+e.ElementType[o.elementType]),j("#card-klass").html(e.getImg20("classes",e.KlassType[o.klassType])+" "+e.KlassType[o.klassType]),j("#card-klass").removeClass("Magic Might Skill").addClass(e.KlassType[o.klassType]),j("#card-rarity").html(e.utils.evoToStars(o.rarityType)+" "+e.RarityType[o.rarityType]),j("#card-types").html(o.types.map(function(t){return e.getImg20("cardtypes",t)+" "+t}).join("<br/>")),j("#card-turns").html(String(o.turns)),j("div.panel-card span.card-targets").html(o.targets.join()),j("div.panel-card span.card-brag").html(String(o.brag)),j("div.panel-card span.card-min").html(o.minValues.map(function(e){return e.join()}).join(" :: ")),j("div.panel-card span.card-max").html(o.maxValues.join(" :: ")),j("div.panel-card span.card-mats").html(o.mats.join()),j("#card-effects").html(o.effects.map(function(t){return e.getImg20("effects",n(t))+" "+t+"<br/>"}).join("")),j("#card-perks").html(o.perks.map(function(t){return e.getImg20("effects",n(t))+" "+t}).join("<br/>")),j("div.panel-card span.card-perk").html(o.perkBase+"%"),j("#card-mats").html(o.mats.map(function(t){return e.getImg20("evojars",n(t))+" "+t}).join("<br/>"));var u=new e.Recipe(o),l=j("#card-evolution > ul.nav > li").toArray();[0,1,2,3,4].forEach(function(t){var r=u.evos[t],i="#evo-"+t+"-"+(t+1),a=j(l[t]).removeClass("disabled");if(!r)return j(i+" tbody").html(""),void a.addClass("disabled");var c="";if(c+=s(e.getImg("misc","Coin"),"Gold",e.data.getMinGoldNeeded(o.rarityType,r.evoFrom),e.data.getMaxGoldNeeded(o.rarityType,r.evoFrom)),r.items.filter(function(e){return!!e.max}).forEach(function(t){return c+=s(e.getImg20("evojars",n(t.item.name)),t.item.name,t.min,t.max)}),5==r.evoTo){var d=e.data.ItemRepo.crystals.find(function(e){return e.elementType==o.elementType}),p=e.data.HeroRepo.all.find(function(e){return e.elementType==o.elementType&&e.klassType==o.klassType}),f=e.data.ItemRepo.runes.find(function(e){return e.name.startsWith(p.name)});c+=s(e.getImg20("crystals",e.ElementType[o.elementType]),d.name,e.data.getMinCrystalsNeeded(o.rarityType,r.evoFrom),e.data.getMaxCrystalsNeeded(o.rarityType,r.evoFrom)),c+=s(e.getImg20("runes",n(p.trait.name)),f.name,e.data.getMinRunesNeeded(o.rarityType,r.evoFrom),e.data.getMaxRunesNeeded(o.rarityType,r.evoFrom))}j(i+" tbody").html(c)}),j("#card-evolution .active").removeClass("active"),j("#card-evolution > ul.nav > li").first().addClass("active"),j("#card-evolution > div.tab-content > div.tab-pane").first().addClass("active")}function s(t,r,n,i){return'<tr><td class="icon">'+t+'</td><td class="name">'+r+'</td><td class="min">'+e.utils.formatNumber(n)+'</td><td class="max">'+e.utils.formatNumber(i)+"</td></tr>"}function u(e){var t=j(e.target),r=t.val(),n=r.trim().toLowerCase();return n?(M=n,void setTimeout(function(e){O[e]||f(e),l(e),A[e]||y(e),c(e),H[e]||h(e),d(e)},0,n)):a()}function l(t){var n=j('a[href="#card-table"] > span.badge');if(t==M){var i=O[t]||[],a=e.data.cards.battle.getAll().map(function(e){return r(e.guid)}).filter(function(e){return!i.includes(e)});j(i.join()).show(),j(a.join()).hide(),n.text(String(i.length))}}function c(e){var t=j('a[href="#effect-table"] > span.badge');if(e==M){var n=A[e]||[],i=E.map(function(e){return r(e)}).filter(function(e){return!n.includes(e)});j(n.join()).show(),j(i.join()).hide(),t.text(String(n.length))}}function d(t){var n=j('a[href="#item-table"] > span.badge');if(t==M){var i=H[t]||[],a=e.data.ItemRepo.all.map(function(e){return r(e.guid)}).filter(function(e){return!i.includes(e)});j(i.join()).show(),j(a.join()).hide(),n.text(String(i.length))}}function p(t){if(!k[t.guid]){var r=k[t.guid]=[];t.brag&&r.push("brag"),t.effects.forEach(function(e){return r.push(e.toLowerCase())}),r.push(e.ElementType[t.elementType].toLowerCase()),r.push(e.KlassType[t.klassType].toLowerCase()),r.push(t.lower),t.mats.forEach(function(e){return r.push(e.toLowerCase())}),t.perks.forEach(function(e){return r.push(e.toLowerCase())}),r.push(e.RarityType[t.rarityType].toLowerCase()),t.targets.forEach(function(e){return r.push(e.toLowerCase())}),r.push(String(t.turns)),t.types.forEach(function(e){return r.push(e.toLowerCase())}),e.data.HeroRepo.all.filter(function(r){return r.klassType==t.klassType&&(t.elementType==e.ElementType.Neutral||r.elementType==t.elementType)}).forEach(function(e){return r.push(e.lower)})}return k[t.guid]||[]}function f(t){var n=t.split(/\s+/);O[t]=e.data.cards.battle.getAll().filter(function(e){return!n.find(function(t){return!g(e,t)})}).map(function(e){return r(e.guid)})}function y(e){var t=e.split(/\s+/);A[e]=E.filter(function(e){return!t.find(function(t){return!e.includes(t)})}).map(function(e){return r(e)})}function h(t){var n=t.split(/\s+/);H[t]=e.data.ItemRepo.all.filter(function(e){return!n.find(function(t){return!b(e,t)})}).map(function(e){return r(e.guid)})}function g(e,t){return!!p(e).find(function(e){return e.includes(t)})}function b(t,r){return t.lower.includes(r)||e.ElementType[t.elementType].toLowerCase().includes(r)||e.RarityType[t.rarityType].toLowerCase().includes(r)}function m(e){function t(e){"MultiFlurry"==e?t("Multi"):"Flurry"!=e&&e.endsWith("Flurry")?t("Flurry"):"Self"==e||"Single"==e||r.includes(e)||r.push(e)}var r=[];return(e.targets||[]).concat(e.effects||[]).concat(e.perks||[]).forEach(t),r.filter(function(e){return!!n(e)})}function v(t){return m(t).map(function(t){return'<span class="card-effect" title="'+t.trim()+'">'+e.getImg20("effects",n(t))+"</span>"})}function T(t){return t.mats.filter(function(e){return!!n(e)}).map(function(t){return'<span class="card-mat" title="'+t.trim()+'">'+e.getImg20("evojars",n(t))+"</span>"})}function P(t){return e.data.HeroRepo.all.filter(function(r){return(t.elementType==e.ElementType.Neutral||r.elementType==t.elementType)&&r.klassType==t.klassType}).map(function(t){return e.getImg("heroes",t.name)})}function x(){var t=e.data.cards.battle.getAll();R(t);var r=[];t.forEach(function(e){return m(e).forEach(function(e){return r.includes(e)?void 0:r.push(e);
})}),w(r.sort()),E=r.map(function(e){return e.toLowerCase()}),C(e.data.ItemRepo.all),j("div.row.alert-row").remove(),j("div.row.table-row").show()}function R(t){j('a[href="#card-table"] > span.badge').text(String(t.length));var r=j("table.card-list > tbody");t.forEach(function(t){p(t);var n='<tr id="'+t.guid+'">';n+='<td><span class="card-cardType">'+e.getImg20("cardtypes",t.brag?"Brag":"BattleCard")+"</span></td>",n+='<td><span class="card-name"><a class="btn btn-link" data-action="show-card" style="padding:0;">'+t.name+"</a></span></td>",n+='<td><span class="card-stars">'+e.utils.evoToStars(t.rarityType)+"</span></td>",n+='<td><span class="card-element">'+(t.elementType==e.ElementType.Neutral?"":e.getImg20("elements",e.ElementType[t.elementType]))+"</span></td>",n+='<td><span class="hidden-xs card-klass '+e.KlassType[t.klassType]+'">'+e.getImg20("classes",e.KlassType[t.klassType])+"</span></td>",n+='<td class="hidden-xs"><span class="card-heroes">'+P(t).join("")+"</span></td>",n+='<td class="hidden-xs"><span class="card-effects">'+v(t).join("")+"</span></td>",n+='<td class="hidden-xs"><span class="card-mats">'+T(t).join("")+"</span></td>",n+='<td class="hidden-xs" style="width:100%;"></td>',n+="</td></tr>",r.append(n)})}function w(t){j('a[href="#effect-table"] > span.badge').text(String(t.length));var i=j("table.effect-list > tbody");t.forEach(function(t){var a='<tr id="'+r(t).slice(1)+'">';a+='<td><span class="card-icon">'+e.getImg20("effects",n(t))+"</span></td>",a+='<td><span class="card-name">'+t+"</span></td>",a+='<td class="hidden-xs" style="width:100%;"></td>',a+="</td></tr>",i.append(a)})}function C(t){j('a[href="#item-table"] > span.badge').text(String(t.length));var r=j("table.mat-list > tbody");t.forEach(function(t){var i=e.ItemType[t.itemType].toLowerCase()+"s",a=t.itemType==e.ItemType.EvoJar?n(t.name):t.itemType==e.ItemType.Crystal?t.name.split(/ /)[0]:n(e.data.HeroRepo.find(t.name.split("'")[0]).abilities[0].name),o='<tr id="'+t.guid+'">';o+='<td><span class="card-icon">'+e.getImg20(i,a)+"</span></td>",o+='<td><span class="card-name">'+t.name+"</span></td>",o+='<td class="hidden-xs" style="width:100%;"></td>',o+="</td></tr>",r.append(o)})}var j=window.jQuery;t.init=i;var M,O={},A={},H={},E=[],k={}})(t=e.library||(e.library={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){var r;(function(t){function r(e,t){return e.elementType==t.elementType?0:e.elementType<t.elementType?-1:1}function n(e,t){return r(e,t)||o(e,t)}function i(e,t){return r(e,t)||l(e,t)}function a(e,t){return r(e,t)||f(e,t)}function o(e,t){return e.klassType==t.klassType?0:e.klassType<t.klassType?-1:1}function s(e,t){return e.evoLevel==t.evoLevel?0:+e.evoLevel<+t.evoLevel?-1:1}function u(e,t){return s(e,t)||l(e,t)}function l(e,t){var r=e.lower||e.name.toLowerCase(),n=e.lower||t.name.toLowerCase();return"sands of time"==r?-1:"sands of time"==n?1:r==n?0:r<n?-1:1}function c(t,r){var n=e.PositionType[t.position],i=e.PositionType[r.position];return n==i?0:n>i?-1:1}function d(e,t){return c(e,t)||l(e,t)}function p(e,t){return e.rarityType==t.rarityType?0:e.rarityType<t.rarityType?-1:1}function f(e,t){return p(e,t)||l(e,t)}function y(e,t){return p(e,t)||l(e,t)||s(e,t)}t.byElement=r,t.byElementThenKlass=n,t.byElementThenName=i,t.byElementThenRarityThenName=a,t.byKlass=o,t.byEvoLevel=s,t.byEvoLevelThenName=u,t.byName=l,t.byPosition=c,t.byPositionThenName=d,t.byRarity=p,t.byRarityThenName=f,t.byRarityThenNameThenEvoLevel=y})(r=t.sort||(t.sort={}))})(t=e.utils||(e.utils={}))})(bh||(bh={}));var bh;(function(e){var t;(function(t){function r(e,t){for(var r=new RegExp("\\w+"),n=e.match(new RegExp("#{\\w+}","g")),i=0,a=n.length;i<a;i++)n[i]=n[i].match(r)[0];var o=e;for(i=0,a=n.length;i<a;i++)for(var s=n[i],u=0,l=t.length;u<l;u++){var c=t[u];if(s in c){o=o.replace("#{"+s+"}",c[s]);break}}return o}function n(e){return String(e).replace(/\</g,"&lt;").replace(/\>/g,"&gt;")}function i(e){return e.reduce(function(e,t){return e.includes(t)?e:e.concat([t])},[])}function a(e){for(var t=String(e).split(""),r=[],n=0,i=t.length;i--;)r.length&&n%3==0&&r.unshift(","),r.unshift(t.pop()),n++;return r.join("")}function o(e,t){var r=10^t,n=e*r,i=Math.round(n),a=i/r;return a}function s(e){var r=t.formatNumber(e),n=r.split(",");return 1==n.length?r:1==n[0].length?n[0]+"."+n[1][0]+"k":n[0]+"k"}function u(e){var t=String(e),r=t.substring(0,1).toLowerCase();return"y"===r||"t"===r||"1"===t}function l(e,t){void 0===t&&(t=String(e+1));for(var r=+t.split(".")[0],n=e+1,i=0,a="";r--;)i++,a+="<span class='evo-star'>&#9733;</span>";for(;i<n;)i++,a+="<span class='star'>&#9734;</span>";return a}function c(e){var t=document.createElement("img");t.setAttribute("src",e);var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var n=r.getContext("2d");n.drawImage(t,0,0);var i=r.toDataURL("image/png");return i}function d(){var t=Object.keys(e.images),r=[],n=e.$("img").toArray().map(function(e){return e.src}).reduce(function(e,t){return e.includes(t)?e:e.concat(t)},[]),i="";i+="var bh;(function (bh) {var images;(function (images) {",e.$("#data-output").val("Loading, please wait ..."),f(n,function(e){var n=e.split("/images/")[1].split(".")[0].split("/");t.includes(n[0])&&2==n.length&&(r.includes(n[0])||(r.push(n[0]),i+="\nimages."+n[0]+" = {};"),i+="\nimages."+n[0]+'["'+n[1]+'"] = "'+c(e)+'";')}).then(function(){i+="\n})(images = bh.images || (bh.images = {}));})(bh || (bh = {}));",e.$("#data-output").val(i)})}function p(e){y[e.playerCard.id]||(console.log("Missing BattleCard:",e.name+": "+e.playerCard.id+" ("+e.evoLevel+")"),y[e.playerCard.id]=!0)}function f(e,t,r){return new Promise(function(n,i){var a=e.map(function(e,n,a){return function(e,n,a){setTimeout(function(e,r,n,a){try{var s=t.call(e,r,n,a);s instanceof Promise?s.then(o,i):o()}catch(e){i(e)}},0,r,e,n,a)}.bind(r,e,n,a)}),o=function(){if(a.length){var t=a.shift();t?t():o()}else n(e)};o()})}t.formatString=r,t.htmlFriendly=n,t.unique=i,t.formatNumber=a,t.round=o,t.truncateNumber=s,t.parseBoolean=u,t.evoToStars=l,t.getBase64Image=c,t.createImagesJs=d;var y={};t.logMissingCard=p,t.asyncForEach=f})(t=e.utils||(e.utils={}))})(bh||(bh={}));var XmlHttpRequest=function(){function e(){var t=this;this.responseFilter=null;var r=e.original||XMLHttpRequest;this.xmlHttpRequest=new r,e.globalListeners.forEach(function(e){try{var r=e.slice(),n=r[1];r[1]=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{n.apply(t,e)}catch(e){console.error("XmlHttpRequest: Firing Global EventListener",e)}},t.addEventListener.apply(t,r)}catch(e){console.error("XmlHttpRequest: Adding Global EventListeners",e)}})}return Object.defineProperty(e.prototype,"onabort",{get:function(){return this.xmlHttpRequest.onabort},set:function(e){this.xmlHttpRequest.onabort=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onerror",{get:function(){return this.xmlHttpRequest.onerror},set:function(e){this.xmlHttpRequest.onerror=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onload",{get:function(){return this.xmlHttpRequest.onload},set:function(e){this.xmlHttpRequest.onload=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onloadend",{get:function(){return this.xmlHttpRequest.onloadend},set:function(e){this.xmlHttpRequest.onloadend=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onloadstart",{get:function(){return this.xmlHttpRequest.onloadstart},set:function(e){this.xmlHttpRequest.onloadstart=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onreadystatechange",{get:function(){return this.xmlHttpRequest.onreadystatechange},set:function(e){this.xmlHttpRequest.onreadystatechange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onprogress",{get:function(){return this.xmlHttpRequest.onprogress},set:function(e){this.xmlHttpRequest.onprogress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ontimeout",{get:function(){return this.xmlHttpRequest.ontimeout},set:function(e){this.xmlHttpRequest.ontimeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this.xmlHttpRequest.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"response",{get:function(){return this.xmlHttpRequest.response},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseJSON",{get:function(){if("json"==this.responseType)return this.xmlHttpRequest.response;try{return JSON.parse(this.responseText)}catch(e){console.error("XmlHttpRequest.responseJSON",e)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseText",{get:function(){var t=this.responseType;if("arraybuffer"==t){var r=this.getResponseHeader("Content-Type"),n=r.match(/UTF\-32/i)?Uint32Array:r.match(/UTF\-16/i)?Uint16Array:Uint8Array;return e.arrayBufferToString(this.xmlHttpRequest.response,n)}return"json"==t?JSON.stringify(this.xmlHttpRequest.response):this.xmlHttpRequest.responseText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseType",{get:function(){return this.xmlHttpRequest.responseType},set:function(e){this.xmlHttpRequest.responseType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"responseXML",{get:function(){return this.xmlHttpRequest.responseXML},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.xmlHttpRequest.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"statusText",{get:function(){return this.xmlHttpRequest.statusText},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"timeout",{get:function(){return this.xmlHttpRequest.timeout},set:function(e){this.xmlHttpRequest.timeout=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withCredentials",{get:function(){return this.xmlHttpRequest.withCredentials},set:function(e){this.xmlHttpRequest.withCredentials=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"upload",{get:function(){return this.xmlHttpRequest.upload},enumerable:!0,configurable:!0}),e.prototype.abort=function(){this.xmlHttpRequest.abort()},e.prototype.addEventListener=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.xmlHttpRequest.addEventListener.apply(this.xmlHttpRequest,e)},e.prototype.getAllResponseHeaders=function(){return this.xmlHttpRequest.getAllResponseHeaders()},e.prototype.getResponseHeader=function(e){return this.xmlHttpRequest.getResponseHeader(e)},e.prototype.open=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.method=e[0]||"",this.requestUrl=e[1]||"",this.xmlHttpRequest.open.apply(this.xmlHttpRequest,e)},e.prototype.overrideMimeType=function(e){this.xmlHttpRequest.overrideMimeType(e)},e.prototype.send=function(e){this.xmlHttpRequest.send(e)},e.prototype.setRequestHeader=function(e,t){this.xmlHttpRequest.setRequestHeader(e,t)},e.addEventListener=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.globalListeners.push(t)},e.attach=function(t,r){e.original=t.XMLHttpRequest,t.XMLHttpRequest=e,r&&e.addEventListener("readystatechange",r)},e.uintArrayToString=function(e){try{for(var t=32768,r=[],n=0,i=e.length;n<i;n+=t)r.push(String.fromCharCode.apply(null,e.subarray(n,n+t)));return decodeURIComponent(escape(r.join("")))}catch(e){console.error("XmlHttpRequest.uintArrayToString",e)}},e.stringToUintArray=function(e,t){try{for(var r=unescape(encodeURIComponent(e)),n=r.split(""),i=[],a=n.length;a--;)i[a]=n[a].charCodeAt(0);return new t(i)}catch(e){console.error("XmlHttpRequest.stringToUintArray",e)}},e.arrayBufferToString=function(t,r){try{r||(r=t instanceof Uint32Array?Uint32Array:t instanceof Uint16Array?Uint16Array:Uint8Array);var n=new r(t);return e.uintArrayToString(n)}catch(e){console.error("XmlHttpRequest.arrayBufferToString",e)}return null},e.get=function(t){return new Promise(function(r,n){var i=new e;i.addEventListener("readystatechange",function(){i.readyState==e.DONE&&r(i.responseText)}),i.open("GET",t,!0),i.send(null)})},e.getJSON=function(t){return new Promise(function(r,n){var i=new e;i.addEventListener("readystatechange",function(){i.readyState==e.DONE&&r(i.responseJSON)}),i.open("GET",t,!0),i.send(null)})},e.post=function(t,r,n){return new Promise(function(i,a){var o=new e;o.addEventListener("readystatechange",function(){o.readyState==e.DONE&&i(o)}),o.open("POST",t,!0),n&&o.setRequestHeader("Content-Type",n),o.send(r)})},e.DONE=XMLHttpRequest.DONE,e.HEADERS_RECEIVED=XMLHttpRequest.HEADERS_RECEIVED,e.LOADING=XMLHttpRequest.LOADING,e.OPENED=XMLHttpRequest.OPENED,e.UNSENT=XMLHttpRequest.UNSENT,e.globalListeners=[],e}();